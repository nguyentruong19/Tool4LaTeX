# coding=utf-8
# src_tool_id.py
import re, os, sys, csv, codecs, time
from datetime import datetime, timedelta
from urllib.request import urlopen
import math, argparse, subprocess, signal, shutil, errno, unicodedata, webbrowser
from fractions import Fraction
from decimal import Decimal
from PyQt5 import QtCore, QtWidgets
from PyQt5.QtGui import *
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *
from def_calculation import *
from src_reg import *
from def_bbt import *
from def_id import *
from def_convert import *
from def_ban_quyen import *
REG_INF = Registry_Inf_get()

class Tool_ID(QWidget):

    def __init__(self, parent=None):
        QWidget.__init__(self, parent)
        self.setLayout(QGridLayout())
        self.group0 = QGroupBox('Danh sách ID5 và ID6 (Update version 5.3)')
        self.group0.vbox = QVBoxLayout()
        self.label1 = QLabel(self)
        self.label1.setText('Lớp  ')
        self.label1.setMinimumWidth(30)
        self.combo1 = QComboBox(self)
        self.combo1.setObjectName('chooseDataComboBox')
        self.combo1.addItem('')
        self.combo1.addItem('[2] Lớp 12')
        self.combo1.addItem('[1] Lớp 11')
        self.combo1.addItem('[0] Lớp 10')
        self.combo1.setMinimumWidth(580)
        self.combo1.currentIndexChanged.connect(self.ID1_change)
        self.label2 = QLabel(self)
        self.label2.setText('Môn  ')
        self.combo2 = QComboBox(self)
        self.combo2.setMinimumWidth(580)
        self.combo2.currentIndexChanged.connect(self.ID2_change)
        self.label3 = QLabel(self)
        self.label3.setText('Chương')
        self.label3.move(10, 70)
        self.combo3 = QComboBox(self)
        self.combo3.move(50, 70)
        self.combo3.setMinimumWidth(580)
        self.combo3.currentIndexChanged.connect(self.ID3_change)
        self.label4 = QLabel(self)
        self.label4.setText('Mức độ')
        self.label4.move(10, 100)
        self.combo4 = QComboBox(self)
        self.combo4.move(50, 100)
        self.combo4.addItem('[X] Mức độ tùy ý')
        self.combo4.addItem('[Y] Nhận biết')
        self.combo4.addItem('[B] Thông hiểu ')
        self.combo4.addItem('[K] Vận dụng thấp')
        self.combo4.addItem('[G] Vận dụng cao')
        self.combo4.addItem('[T] Bài toán thực tế')
        self.combo4.currentIndexChanged.connect(self.ID4_change)
        self.combo4.setMinimumWidth(580)
        self.label5 = QLabel(self)
        self.label5.setText('Bài')
        self.label5.move(10, 130)
        self.combo5 = QComboBox(self)
        self.combo5.move(50, 130)
        self.combo5.setMinimumWidth(580)
        self.combo5.currentIndexChanged.connect(self.ID5_change)
        self.label6 = QLabel(self)
        self.label6.setText('Dạng')
        self.label6.move(10, 160)
        self.combo6 = QComboBox(self)
        self.combo6.move(50, 160)
        self.combo6.setMinimumWidth(580)
        self.combo6.currentIndexChanged.connect(self.ID6_full)
        self.label = QLabel(self)
        self.label.setText('ID6 ')
        self.label.move(20, 190)
        self.line = QLabel(self)
        self.line.setMinimumWidth(580)
        self.group0.hbox1 = QHBoxLayout()
        self.group0.hbox1.addWidget(self.label1)
        self.group0.hbox1.addWidget(self.combo1)
        self.group0.hbox2 = QHBoxLayout()
        self.group0.hbox2.addWidget(self.label2)
        self.group0.hbox2.addWidget(self.combo2)
        self.group0.hbox3 = QHBoxLayout()
        self.group0.hbox3.addWidget(self.label3)
        self.group0.hbox3.addWidget(self.combo3)
        self.group0.hbox4 = QHBoxLayout()
        self.group0.hbox4.addWidget(self.label4)
        self.group0.hbox4.addWidget(self.combo4)
        self.group0.hbox5 = QHBoxLayout()
        self.group0.hbox5.addWidget(self.label5)
        self.group0.hbox5.addWidget(self.combo5)
        self.group0.hbox6 = QHBoxLayout()
        self.group0.hbox6.addWidget(self.label6)
        self.group0.hbox6.addWidget(self.combo6)
        self.group0.hbox7 = QHBoxLayout()
        self.group0.hbox7.addWidget(self.label)
        self.group0.hbox7.addWidget(self.line)
        self.group0.vbox.addItem(self.group0.hbox1)
        self.group0.vbox.addItem(self.group0.hbox2)
        self.group0.vbox.addItem(self.group0.hbox3)
        self.group0.vbox.addItem(self.group0.hbox4)
        self.group0.vbox.addItem(self.group0.hbox5)
        self.group0.vbox.addItem(self.group0.hbox6)
        self.group0.vbox.addItem(self.group0.hbox7)
        self.group0.setLayout(self.group0.vbox)
        self.group0.setMaximumHeight(240)
        self.group1 = QGroupBox('Lọc câu theo một ID cụ thể')
        self.group1.setMinimumHeight(100)
        self.group1.vbox = QVBoxLayout()
        self.group1.hboxhd = QHBoxLayout()
        self.group1.check = QCheckBox('HD')
        self.group1.check.setChecked(True)
        self.group1.hd = QGroupBox('Hướng dẫn')
        self.group1.hboxhd.addWidget(self.group1.check)
        self.group1.hboxhd.addWidget(self.group1.hd)
        self.group1.hbox1 = QHBoxLayout()
        self.group1.label1 = QLabel('Files ')
        self.group1.label1.setMinimumWidth(30)
        self.group1.line1 = QLineEdit()
        self.group1.button1 = QPushButton('Chọn')
        self.group1.button1.clicked.connect(self.G1_get_file_1)
        self.group1.hbox2 = QHBoxLayout()
        self.group1.label2 = QLabel('ID ')
        self.group1.label2.setMinimumWidth(30)
        self.group1.line2 = QLineEdit()
        self.group1.checkbox = QCheckBox('Trích dẫn nguồn')
        self.group1.checkbox.setChecked(False)
        self.group1.label = QLabel('   ')
        self.group1.label3 = QLabel('   EX: 2D1X1-1: X lấy mức độ bất kì, sắp xếp từ Y-B-K-G-T    ')
        self.group1.button2 = QPushButton('Lọc')
        self.group1.button2.clicked.connect(self.G1_get_file_2)
        self.group1.hbox1.addWidget(self.group1.label1)
        self.group1.hbox1.addWidget(self.group1.line1)
        self.group1.hbox1.addWidget(self.group1.button1)
        self.group1.hbox2.addWidget(self.group1.label2)
        self.group1.hbox2.addWidget(self.group1.line2)
        self.group1.hbox2.addWidget(self.group1.label)
        self.group1.hbox2.addWidget(self.group1.checkbox)
        self.group1.hbox2.addWidget(self.group1.label3)
        self.group1.hbox2.addWidget(self.group1.button2)
        self.group1.vbox.addItem(self.group1.hbox1)
        self.group1.vbox.addItem(self.group1.hbox2)
        self.group1.setLayout(self.group1.vbox)
        self.group1.setMaximumHeight(90)
        self.group2 = QGroupBox('Sắp xếp đề theo mức độ, môn, chương, bài, dạng.')
        self.group2.vbox = QVBoxLayout()
        self.group2.hbox1 = QHBoxLayout()
        self.group2.hbox1.label1 = QLabel('Files')
        self.group2.hbox1.line1 = QLineEdit('')
        self.group2.hbox1.button1 = QPushButton('Chọn')
        self.group2.hbox1.addWidget(self.group2.hbox1.label1)
        self.group2.hbox1.addWidget(self.group2.hbox1.line1)
        self.group2.hbox1.addWidget(self.group2.hbox1.button1)
        self.group2.setMaximumHeight(100)
        self.group2.hbox2 = QHBoxLayout()
        self.group2.hbox2.label0 = QLabel('ID')
        self.group2.hbox2.combo0 = QComboBox()
        self.group2.hbox2.combo0.addItem('ID6')
        if REG_INF >= 4:
            self.group2.hbox2.combo0.addItem('ID5')
        self.group2.hbox2.label2 = QLabel('Thứ tự Mức độ')
        self.group2.hbox2.label3 = QLabel('Tùy chỉnh')
        self.group2.hbox2.combo = QComboBox()
        self.group2.hbox2.combo.addItem('Y-B-K-G-T')
        self.group2.hbox2.combo.addItem('Y-B-K-T-G')
        self.group2.hbox2.combo1 = QComboBox()
        self.group2.hbox2.combo1.addItem('Mức độ - Lớp - Môn - Bài - Dạng')
        self.group2.hbox2.combo1.addItem('Lớp - Môn - Bài - Dạng - Mức độ ')
        self.group2.hbox2.combo1.addItem('Môn - Lớp - Bài - Dạng - Mức độ ')
        self.group2.hbox2.button2 = QPushButton('Sắp xếp')
        self.group2.hbox2.addWidget(self.group2.hbox2.label0)
        self.group2.hbox2.addWidget(self.group2.hbox2.combo0)
        self.group2.hbox2.addWidget(self.group2.hbox2.label2)
        self.group2.hbox2.addWidget(self.group2.hbox2.combo)
        self.group2.hbox2.addWidget(self.group2.hbox2.label3)
        self.group2.hbox2.addWidget(self.group2.hbox2.combo1)
        self.group2.hbox2.addWidget(self.group2.hbox2.button2)
        self.group2.setLayout(self.group2.vbox)
        self.group2.vbox.addLayout(self.group2.hbox1)
        self.group2.vbox.addLayout(self.group2.hbox2)
        self.group2.hbox1.button1.clicked.connect(self.G2_get_file_1)
        self.group2.hbox2.button2.clicked.connect(self.G2_get_file_2)
        self.group3 = QGroupBox('Lọc lấy code Tikz theo một ID cụ thể (hoặc không theo ID)')
        self.group3.setMinimumHeight(60)
        self.group3.vbox = QVBoxLayout()
        self.group3.hboxhd = QHBoxLayout()
        self.group3.check = QCheckBox('HD')
        self.group3.check.setChecked(True)
        self.group3.hd = QGroupBox('Hướng dẫn')
        self.group3.hboxhd.addWidget(self.group3.hd)
        self.group3.hbox1 = QHBoxLayout()
        self.group3.label1 = QLabel('Files ')
        self.group3.label1.setMinimumWidth(30)
        self.group3.line1 = QLineEdit()
        self.group3.button1 = QPushButton('Chọn')
        self.group3.button1.clicked.connect(self.G3_get_file_1)
        self.group3.hbox2 = QHBoxLayout()
        self.group3.label2 = QLabel(' ID ')
        self.group3.label2.setMaximumWidth(40)
        self.group3.line2 = QLineEdit()
        self.group3.line2.setMaximumWidth(60)
        self.group3.checkbox = QCheckBox('Trích dẫn nguồn')
        self.group3.checkbox.setChecked(False)
        self.group3.label = QLabel('   ')
        self.group3.label3 = QLabel('   EX: 2D1X1-1: X lấy mức độ bất kì, sắp xếp từ Y-B-K-G-T    ')
        self.group3.button2 = QPushButton('Lọc')
        self.group3.button2.clicked.connect(self.G3_get_file_2)
        self.group3.hbox1.addWidget(self.group3.label1)
        self.group3.hbox1.addWidget(self.group3.line1)
        if REG_INF > 1:
            self.group3.hbox1.addWidget(self.group3.label2)
            self.group3.hbox1.addWidget(self.group3.line2)
        self.group3.hbox1.addWidget(self.group3.label)
        self.group3.hbox1.addWidget(self.group3.button1)
        self.group3.hbox1.addWidget(self.group3.button2)
        self.group3.setLayout(self.group3.hbox1)
        self.group3.setMaximumHeight(65)
        self.group4 = QGroupBox('Lọc câu theo theo ID (hoặc không) theo từ khóa')
        self.group4.setMinimumHeight(60)
        self.group4.vbox = QVBoxLayout()
        self.group4.hboxhd = QHBoxLayout()
        self.group4.check = QCheckBox('HD')
        self.group4.check.setChecked(True)
        self.group4.hd = QGroupBox('Hướng dẫn')
        self.group4.hboxhd.addWidget(self.group4.hd)
        self.group4.hbox1 = QHBoxLayout()
        self.group4.label1 = QLabel('Files ')
        self.group4.label1.setMinimumWidth(30)
        self.group4.line1 = QLineEdit()
        self.group4.button1 = QPushButton('Chọn')
        self.group4.button1.clicked.connect(self.G4_get_file_1)
        self.group4.hbox2 = QHBoxLayout()
        self.group4.label2 = QLabel(' ID ')
        self.group4.label2.setMaximumWidth(40)
        self.group4.line2 = QLineEdit()
        self.group4.line2.setMaximumWidth(60)
        self.group4.checkbox = QCheckBox('Trích dẫn nguồn')
        self.group4.checkbox.setChecked(False)
        self.group4.label3 = QLabel('Từ khóa 1 ')
        self.group4.line3 = QLineEdit()
        self.group4.label4 = QLabel('Từ khóa 2 ')
        self.group4.label = QLabel('  ')
        self.group4.line4 = QLineEdit()
        self.group4.combo = QComboBox()
        self.group4.combo.addItem('and')
        self.group4.combo.addItem('or')
        self.group4.button2 = QPushButton('Lọc')
        self.group4.button2.clicked.connect(self.G4_get_file_2)
        self.group4.hbox1.addWidget(self.group4.label1)
        self.group4.hbox1.addWidget(self.group4.line1)
        if REG_INF > 1:
            self.group4.hbox1.addWidget(self.group4.label2)
            self.group4.hbox1.addWidget(self.group4.line2)
        self.group4.hbox1.addWidget(self.group4.button1)
        self.group4.hbox2.addWidget(self.group4.label3)
        self.group4.hbox2.addWidget(self.group4.line3)
        self.group4.hbox2.addWidget(self.group4.label)
        self.group4.hbox2.addWidget(self.group4.combo)
        self.group4.hbox2.addWidget(self.group4.label)
        self.group4.hbox2.addWidget(self.group4.label4)
        self.group4.hbox2.addWidget(self.group4.line4)
        self.group4.hbox2.addWidget(self.group4.button2)
        self.group4.vbox.addItem(self.group4.hbox1)
        self.group4.vbox.addItem(self.group4.hbox2)
        self.group4.setLayout(self.group4.vbox)
        self.group8 = QGroupBox('Update to be continue')
        self.group8.setMinimumHeight(150)
        self.group5 = QGroupBox('ID5')
        self.group6 = QGroupBox('ID6')
        self.group7 = QGroupBox('ID5')
        self.group8 = QGroupBox('Update to be continue')
        self.group9 = QGroupBox('ID5')
        self.group10 = QGroupBox('ID6')
        self.layout().addWidget(self.group0, 0, 0, 1, 2)
        self.layout().addWidget(self.group1, 1, 0, 1, 2)
        self.layout().addWidget(self.group3, 2, 0, 1, 2)
        self.layout().addWidget(self.group4, 3, 0, 1, 2)
        if REG_INF >= 3:
            self.layout().addWidget(self.group2, 5, 0, 1, 2)
        self.layout().addWidget(self.group8, 8, 0, 1, 2)

    def ID1_change(self):
        try:
            ID1 = self.combo1.currentText()[1]
            self.combo2.clear()
            for ID_1 in Call_ID_1(ID1)[1]:
                self.combo2.addItem(ID_1)

        except Exception as er:
            self.combo2.clear()

    def ID2_change(self):
        try:
            ID1 = self.combo1.currentText()[1]
            ID2 = self.combo2.currentText()[1]
            self.combo3.clear()
            for ID_3 in Call_ID_2(ID1, ID2)[1]:
                self.combo3.addItem(ID_3)

        except Exception as er:
            self.combo3.clear()

    def ID3_change(self):
        try:
            ID1 = self.combo1.currentText()[1]
            ID2 = self.combo2.currentText()[1]
            ID3 = self.combo3.currentText()[1]
            self.combo5.clear()
            for ID_4 in Call_ID_3(ID1, ID2, ID3)[1]:
                self.combo5.addItem(ID_4)

        except Exception as er:
            self.combo5.clear()

    def ID4_change(self):
        try:
            self.line.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
            self.group1.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
            self.group3.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
            self.group4.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
        except Exception as err:
            self.line.setText('')

    def ID5_change(self):
        try:
            ID1 = self.combo1.currentText()[1]
            ID2 = self.combo2.currentText()[1]
            ID3 = self.combo3.currentText()[1]
            ID4 = self.combo5.currentText()[1]
            self.combo6.clear()
            self.combo6.addItem('')
            for ID_5 in Call_ID_4(ID1, ID2, ID3, ID4)[1]:
                self.combo6.addItem(ID_5)

            self.line.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1])
            self.group1.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1])
            if REG_INF > 1:
                self.group3.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1])
                self.group4.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1])
        except Exception as er:
            self.combo6.clear()

    def ID6_full(self):
        try:
            self.line.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
            self.group1.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
            if REG_INF > 1:
                self.group3.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
                self.group4.line2.setText(self.combo1.currentText()[1] + self.combo2.currentText()[1] + self.combo3.currentText()[1] + self.combo4.currentText()[1] + self.combo5.currentText()[1] + '-' + self.combo6.currentText()[1])
        except Exception as err:
            self.line.setText('')

    def G1_get_file_1(self):
        fname = QFileDialog.getOpenFileNames()
        filename = ''
        for i in fname[0]:
            filename += i + ','

        self.group1.line1.setText(filename[:-1])

    def G1_get_file_2(self):
        if 1 == 1:
            state = self.group1.checkbox.isChecked()
            start_time = time.time()
            List = List_creat(self.group1.line1.text())
            ID = self.group1.line2.text()
            block_ID = ''
            i = 0
            j = 0
        try:
            if ID[3] == 'X':
                for ID_new in [ID.replace('X', 'Y'), ID.replace('X', 'B'), ID.replace('X', 'K'), ID.replace('X', 'G'), ID.replace('X', 'T')]:
                    if ID[3] == 'Y':
                        block_ID += '%\\subsubsection{Các bài toán nhận biết}\r\n'
                    if ID[3] == 'B':
                        block_ID += '%\\subsubsection{Các bài toán thông hiểu}\r\n'
                    if ID[3] == 'K':
                        block_ID += '%\\subsubsection{Các bài toán vận dụng thấp}\r\n'
                    if ID[3] == 'G':
                        block_ID += '%\\subsubsection{Các bài toán vận dụng cao}\r\n'
                    if ID[3] == 'T':
                        block_ID += '%\\subsubsection{Các bài toán thực tế}\r\n'
                    for filename in List:
                        block, j = get_block_ID_spec(filename, ID_new, state)
                        if j != 0:
                            block_ID += '\r\n' + block
                        i += j

        except Exception as er:
            for filename in List:
                block, j = get_block_ID_spec(filename, ID, state)
                block_ID += block
                i += j

        if i != 0:
            with codecs.open('Tool_ID/[' + ID + '].tex', 'w', 'utf-8') as (f):
                f.write(block_ID)
            Print = 'Các câu được lưu trong Tool_ID\\[' + ID + '].tex'
            t = time.time() - start_time
            hour, minute, second = Time_convert(t)
            reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(i) + ' câu thỏa mãn ID đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print + '\nBạn có muốn mở file không?', QMessageBox.Yes, QMessageBox.No)
            if reply == QMessageBox.Yes:
                path='Tool_ID\\[' + ID + '].tex'
                if openfile(path)=='Error':
                    QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
            else:
                Print = ''
                t = time.time() - start_time
                hour, minute, second = Time_convert(t)
                reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(i) + ' câu thỏa mãn ID đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print, QMessageBox.Yes)

    def G2_get_file_1(self):
        if REG_INF == 1:
            QMessageBox.question(self, 'Thông báo', 'Vui lòng đăng kí tài khoản để sử dụng', QMessageBox.Yes)
        else:
            if REG_INF == 2 or REG_INF == 3:
                fname = QFileDialog.getOpenFileName()
                self.group2.hbox1.line1.setText(fname[0])
            else:
                fname = QFileDialog.getOpenFileNames()
                filename = ''
                for i in fname[0]:
                    filename += i + ','

                self.group2.hbox1.line1.setText(filename[:-1])

    def G2_get_file_2(self):
        start_time = time.time()
        if self.group2.hbox2.combo.currentIndex() == 0:
            type_arrange = [
             'Y', 'B', 'K', 'G', 'T']
        else:
            if self.group2.hbox2.combo.currentIndex() == 1:
                type_arrange = [
                 'Y', 'B', 'K', 'T', 'G']
        if self.group2.hbox2.combo0.currentIndex() == 0:
            List = List_creat(self.group2.hbox1.line1.text())
            for filename in List:
                i = 0
                block1 = ''
                block2 = ''
                block = ''
                data = codecs.open(filename, 'r', 'utf-8')
                Found = False
                End = False
                for line in data:
                    if Found:
                        if 'end{ex}' in line:
                            Found = False
                            End = True
                    else:
                        if 'begin{ex}' in line:
                            i += 1
                            Found = True
                            End = False
                        if End:
                            if line != '\n':
                                block2 += line
                        if not Found and not End:
                            block1 += line

                head, tail = os.path.split(filename)
                if self.group2.hbox2.combo1.currentIndex() == 0:
                    block = ID_file_arrange_YtoG(filename, type_arrange)
                else:
                    if self.group2.hbox2.combo1.currentIndex() == 1:
                        block = ID_file_arrange_bai(filename, type_arrange)
                    else:
                        if self.group2.hbox2.combo1.currentIndex() == 2:
                            block = ID_file_arrange_mon(filename, type_arrange)
                ID_loi, block_loi = ID_file_arrange_loi(filename, type_arrange)
                block += block_loi
                with codecs.open('Tool_ID/' + tail, 'w', 'utf-8') as (f):
                    f.write(block1)
                    f.write(block)
                    f.write('\n' + block2)
                    f.close()
                    block = ''

            t = time.time() - start_time
            hour, minute, second = Time_convert(t)
            buttonReply = QMessageBox.question(self, 'Thông báo', 'Thời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\nBạn có muốn mở file không?', QMessageBox.Yes, QMessageBox.No)
            if buttonReply == QMessageBox.Yes:
                path='Tool_ID\\' + tail
                if openfile(path)=='Error':
                    QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
            else:
                if self.group2.hbox2.combo0.currentIndex() == 1:
                    start_time = time.time()
                    List = List_creat(self.group2.hbox1.line1.text())
                    for filename in List:
                        i = 0
                        block1 = ''
                        block2 = ''
                        block = ''
                        data = codecs.open(filename, 'r', 'utf-8')
                        Found = False
                        End = False
                        for line in data:
                            if Found:
                                if 'end{ex}' in line:
                                    Found = False
                                    End = True
                                else:
                                    if 'begin{ex}' in line:
                                        i += 1
                                        Found = True
                                        End = False
                                if End:
                                    if line != '\r\n':
                                        block2 += line
                                if not Found:
                                    if not End:
                                        block1 += line

                        head, tail = os.path.split(filename)
                        if self.group2.hbox2.combo1.currentIndex() == 0:
                            block = ID_file_arrange_YtoG_ID5(filename, type_arrange)
                        else:
                            if self.group2.hbox2.combo1.currentIndex() == 1:
                                block = ID_file_arrange_bai_ID5(filename, type_arrange)
                            else:
                                if self.group2.hbox2.combo1.currentIndex() == 2:
                                    block = ID_file_arrange_mon_ID5(filename, type_arrange)
                        with codecs.open('Tool_ID/' + tail, 'w', 'utf-8') as (f):
                            f.write(block1)
                            f.write(block)
                            f.write(block2)
                            f.close()
                            block1 = ''
                            block2 = ''
                            block = ''

                    t = time.time() - start_time
                    hour, minute, second = Time_convert(t)
                    buttonReply = QMessageBox.question(self, 'Thông báo', 'Thời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\nBạn có muốn mở file không?', QMessageBox.Yes, QMessageBox.No)
                    if buttonReply == QMessageBox.Yes:
                        path='Tool_ID\\' + tail
                        if openfile(path)=='Error':
                            QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)

    def G3_get_file_1(self):
        fname = QFileDialog.getOpenFileNames()
        filename = ''
        for i in fname[0]:
            filename += i + ','

        self.group3.line1.setText(filename[:-1])

    def G3_get_file_2(self):
        try:
            state = self.group3.checkbox.isChecked()
            start_time = time.time()
            List = List_creat(self.group3.line1.text())
            ID = self.group3.line2.text()
            block_ID = ''
            i = 0
            try:
                if ID[3] == 'X':
                    for ID in [ID.replace('X', 'Y'), ID.replace('X', 'B'), ID.replace('X', 'K'), ID.replace('X', 'G'), ID.replace('X', 'T')]:
                        for filename in List:
                            block, j = get_block_ID_exbt(filename, ID, state)
                            if j != 0:
                                block_ID += '\r\n' + block
                            i += j

            except Exception as er:
                for filename in List:
                    block, j = get_block_ID_exbt(filename, ID, state)
                    block_ID += '\r\n' + block
                    i += j

            if i != 0:
                with codecs.open('Tool_ID/[' + ID + '].tex', 'w', 'utf-8') as (f):
                    f.write(block_ID)
                block_Tikz, k = ID_get_Tikz('Tool_ID/[' + ID + '].tex')
                with codecs.open('Tool_ID/[' + ID + ']-Tikz.tex', 'w', 'utf-8') as (f):
                    f.write(block_Tikz)
                main = '\\documentclass[12pt,a4paper]{article}\n%\\usepackage{fourier}\n\\usepackage[utf8]{vietnam}\n\\usepackage{amsmath,amssymb,yhmath,mathrsfs,fancyhdr,tkz-euclide,tikz-3dplot}\n\\usepackage{framed,tikz,tkz-tab,tkz-linknodes,pgfplots,currfile,enumerate}\n\\usetikzlibrary{shapes.geometric,arrows,calc,intersections,angles,patterns,snakes,shadings,quotes}\n\\usetkzobj{all}\n\\usepgfplotslibrary{fillbetween}\n\\pgfplotsset{compat=1.9}\n\\usepackage[top=1.5cm, bottom=1.5cm, left=1.5cm, right=1.5cm] {geometry}\n\\usepackage[hidelinks,unicode,pdfencoding=unicode, psdextra]{hyperref}\n\\usepackage[loigiai]{ex_test}\n\\renewcommand{\\vec}[1]{\\protect\\overrightarrow{#1}}\n\\newcommand{\\hoac}[1]{\\left[\\begin{aligned}#1\\end{aligned}\\right.}\n\\newcommand{\\heva}[1]{\\left\\{\\begin{aligned}#1\\end{aligned}\\right.}\n\\renewcommand{\\labelenumi}{\\alph{enumi})}\n\\usepackage{multirow}\n\\usepackage{makecell}\n\\usepackage{lastpage}\n\\renewcommand{\\baselinestretch}{1.2}\n% Format nhóm LaTeX\n\\usepackage{fancyhdr}\n\\pagestyle{fancy}\n\\lhead{\\color{blue!50!black} \\sc Dự án (2019)}\n\\rhead{\\color{blue!50!black}\\sc Nhóm \\LaTeX}\n\\lfoot{\\color{blue!50!black}\\href{https://www.facebook.com/groups/NganHangOffline/}{/groups/NganHangOffline/}}\n\\cfoot{}\n\\renewcommand{\\headrulewidth}{0.1pt}\n\\renewcommand{\\footrulewidth}{0.1pt}\n% Định nghĩa làm tiêu đề của gói dethi\n\\usepackage{refcount}\n\\newcommand{\\pagediff}[1]{%\n\t\\number\\numexpr\\getpagerefnumber{#1}-\\thepage+1\\relax}\n\\newcommand{\\@ttruong}{Sở GD\\&ĐT TP. Hồ Chí Minh}\n\\newcommand{\\@tkhoa}{THPT Trần Hưng Đạo}\n\\newcommand{\\@ldethi}{(Đề thi có \\@scau\\, câu/\\@strang\\, trang.)}\n\\newcommand{\\@tkythi}{Đề thi thử THPT Quốc Gia năm 2019}\n\\newcommand{\\@tmonhoc}{Môn Toán: 12.}\n\\newcommand{\\@tgian}{45}\n\\newcommand{\\@scau}{50}\n\\newcommand{\\@strang}{4}\n\\newcommand{\\@madethi}{Mã đề thi: 108}\n\\newcommand{\\@hovaten}{\\dotfill}\n\\newcommand{\\@sobaodanh}{\\dotfill}\n\\newcommand{\\tentruong}[1]{\\renewcommand{\\@ttruong}[1]{#1}}\n\\newcommand{\\tenkhoa}[1]{\\renewcommand{\\@tkhoa}{#1}}\n\\newcommand{\\loaidethi}[1]{\\renewcommand{\\@ldethi}{#1}}\n\\newcommand{\\tenkythi}[1]{\\renewcommand{\\@tkythi}{#1}}\n\\newcommand{\\tenmonhoc}[1]{\\renewcommand{\\@tmonhoc}{#1}}\n\\newcommand{\\thoigian}[1]{\\renewcommand{\\@tgian}{#1}}\n\\newcommand{\\socauhoi}[1]{\\renewcommand{\\@scau}{#1}}\n\\newcommand{\\sotrang}[1]{\\renewcommand{\\@strang}{#1}}\n\\newcommand{\\madethi}[1]{\\renewcommand{\\@madethi}{Mã đề thi: #1}}\n\\newcommand{\\hovaten}[1]{\\renewcommand{\\@hovaten}{\\color{red}#1}}\n\\newcommand{\\sobaodanh}[1]{\\renewcommand{\\@sobaodanh}{{\\color{red}#1}}}\n\\newcommand{\\lamtieude}{\n\\begin{minipage}[b]{0.35\\textwidth}\n\\centering\\textbf{\\@ttruong}\\\\\\textbf{\\@tkhoa}\\\\\\@ldethi\n\\end{minipage}\n\\hfill\n\\begin{minipage}[b]{0.65\\textwidth}\n\\centering\\textbf{\\@tkythi}\\\\\\textbf{\\@tmonhoc}\\\\\\underline{\\it Thời gian làm bài \\@tgian\\ phút.}\\\\\n\\end{minipage}\\vspace{3pt}\n\\begin{minipage}[b]{0.6\\textwidth}\n\\bf Họ và tên: \\@hovaten\n\\end{minipage}\n\\begin{minipage}[b]{0.4\\textwidth}\n\\bf SBD: \\@sobaodanh\\hfill\\fbox{\\@madethi}\n\\end{minipage}\n\\bigskip\n}\n\\rfoot{\\color{blue!50!black} Trang \\thepage/\\pageref{LastPage}\\, -- \\@madethi }% Ẩn hiện làm đáp án\n\\newcommand{\\hienda}{1}% 1: hiện đáp án, 0: không hiện đáp án\n\\ifthenelse{\\hienda=1}{\\newcommand{\\lamdapan}[1]{\n\\newpage\n\\begin{center}\n\\textbf{ĐÁP ÁN}\n\\end{center}\n\\begin{multicols}{10}\n\\input{#1}\n\\end{multicols}}}{\\newcommand{\\lamdapan}[1]{}}\n% Logo\n%\\usepackage[pages=all,placement=center]{background}\n%\\backgroundsetup{position={16cm,1.3cm},scale=1,color=black,opacity=0.2,angle=0,contents={\\centering{\\includegraphics[scale = 0.7]{LOGO}}}}\n\\renewtheorem{ex}{\\color{violet}Câu}\n\\newtheorem{bt}{\\color{violet}Bài}\n\\begin{document}\n\\input{[' + ID + ']-Tikz}\n\\end{document}\n'
                with codecs.open('Tool_ID/[' + ID + ']-Tikz-main.tex', 'w', 'utf-8') as (f):
                    f.write(main)
                ex_test = "\\ProvidesPackage{ex_test}[2018/07/29 for Ex_test version 2.4.3, Tran Anh Tuan]\n\\RequirePackage{ifthen}\n\\RequirePackage{fancyhdr}\n\\RequirePackage{multicol}\n\\RequirePackage{answers}\n\\RequirePackage{array}\n\\RequirePackage{multirow}\n\\RequirePackage{longtable}\n\\RequirePackage[utf8]{vietnam}\n\\RequirePackage{tikz}\n\\RequirePackage{ntheorem}\n\\RequirePackage{calc}\n\\RequirePackage{etoolbox}\n\\RequirePackage{probsoln}\n\\RequirePackage{picinpar}\n\\RequirePackage{filecontents}\n\\RequirePackage {expl3,xparse,epic,cntformats,xtemplate,environ}\n\n%Ẩn hiện công thức tự động\n\\newlength\\wsh\n\\newlength\\hsh\n\\newlength\\dsh\n\\newcommand{\\sh}[1]{%\n\\settowidth\\wsh{#1}%\n\\settoheight\\hsh{#1}%\n\\settodepth\\dsh{#1}%\n\\raisebox{0pt}[\\hsh][\\dsh]{\n\\rule{\\wsh}{0.1pt}}}\n\\newcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\newcommand{\\boxEX}[2][9pt]{%\n\\def\\sizeboxEX{#1}%\n\\setbox1=\\hbox{#2}%\n\\ \\EXbox{#2}\\ %\n}\n%Lệnh tagEX gán nhãn công thức thủ công\n\\newcommand{\\tagEX}[1]{%\n\\hfill{\\rm (#1)}%\n\\par\n\\@ifnextchar\\begin%\n{\\vspace{-\\baselineskip}}\n{}\n}\n%Đánh dấu phương án đúng\n\\newcommand{\\dapan}{Lệnh này giờ vô dụng}\n\\newcommand*\\circled[1]{\\tikz[baseline=(char.base)]{\n\\node[shape=circle,draw,inner sep=0.8pt] (char) {#1};}}\n\\newcommand*\\circEX[1]{\\tikz[baseline=(char.base)]{\\node[shape=circle,draw=red,inner sep=1pt] (char) {\\bf\\color{red} #1};}}\n\\newcommand*\\squareEX[1]{\\tikz[baseline=(char.base)]{\\node[shape=rectangle,draw=red,inner sep=2.5pt,fill=yellow!50] (char) {\\color{red} #1};}}\n\\newcounter{dapan}\n\\newcommand{\\TrueEX}{\\stepcounter{dapan}{{\\color{blue}\\circled{\\textbf{\\Alph{dapan}}}} \\ignorespaces}}\n\\newcommand{\\FalseEX}{\\stepcounter{dapan}{\\color{blue}\\circled{\\textbf{\\Alph{dapan}}} \\ignorespaces}}\n\\newlength\\widthalpha\n\\newlength\\widthalphaT\n\\newlength\\widthalphaF\n\\settowidth\\widthalphaT{\\TrueEX}\n\\settowidth\\widthalphaF{\\FalseEX}\n\\ifdim\\widthalpha<\\widthalphaT\\relax\\setlength{\\widthalpha}{\\widthalphaT}\\fi%\n\\ifdim\\widthalpha<\\widthalphaF\\relax\\setlength{\\widthalpha}{\\widthalphaF}\\fi%\n\\newcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\newcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n%Hiện Chọn đáp án trong lời giải chi tiết\n\\def\\selectA{\\par\\noindent Chọn đáp án \\circEX{A}}\n\\def\\selectB{\\par\\noindent Chọn đáp án \\circEX{B}}\n\\def\\selectC{\\par\\noindent Chọn đáp án \\circEX{C}}\n\\def\\selectD{\\par\\noindent Chọn đáp án \\circEX{D}}\n\\def\\selectE{\\par\\noindent Chọn đáp án \\circEX{E}}\n\\newcommand{\\hidetextchoice}{\n\\def\\selectA{}\n\\def\\selectB{}\n\\def\\selectC{}\n\\def\\selectD{}\n\\def\\selectE{}\n}\n\\newcommand{\\showtextchoice}{\n\\def\\selectA{\\par\\noindent Chọn đáp án \\circEX{A}}\n\\def\\selectB{\\par\\noindent Chọn đáp án \\circEX{B}}\n\\def\\selectC{\\par\\noindent Chọn đáp án \\circEX{C}}\n\\def\\selectD{\\par\\noindent Chọn đáp án \\circEX{D}}\n\\def\\selectE{\\par\\noindent Chọn đáp án \\circEX{E}}\n}\n%Tương thích môi trường enumerate,itemize\n\\def\\hfillEX{}\n\\BeforeBeginEnvironment{enumerate}\n{\\hfillEX}\n\\BeforeBeginEnvironment{itemize}\n{\\hfillEX}\n\\AtBeginEnvironment{multicols}\n{\\def\\hfillEX{}}\n\\newcommand{\\listenumerate}[1]{\n\\foreach \\xenumerate in {#1} {%môi trường\n\\AtBeginEnvironment{\\xenumerate}{\n\\def\\hfillEX{\\hfill}\n}\n\\AtEndEnvironment{\\xenumerate}{\n\\def\\hfillEX{}\n}\n}}\n\\listenumerate{ex}\n%Lời giải\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\dotlineans}[2]{\n\\AtBeginEnvironment{#2}{\n\\def\\colorEX{}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\makeatletter\n\\renewcommand{\\loigiai}[1]{\n\\dotlineEX{#1}\n}}}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\showansEX}[1]{\n\\AtBeginEnvironment{#1}{\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n##1%\n{}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\selectA\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\selectB\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\selectC\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\selectD\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\selectE \n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n##1\n\\end{onlysolution}\n}\n}}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\hideansEX}[1]{\n\\AtBeginEnvironment{#1}{\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\colorEX{}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\renewenvironment{onlysolution}{%\n\\long@collect@body\\do@onlysolution\n}{}\n\\renewcommand{\\loigiai}[1]{\n}\n}}\n%Định nghĩa QED kết thúc chứng minh\n\\def\\qedEX{\\ensuremath{\\square}}\n%Đáp số câu hỏi tự luận\n\\Newassociation{solshort}{Solshort}{ansshort}\n\\renewcommand{\\Solshortlabel}[1]{\\color{violet}\\textbf{#1.}\n}\n\\newcommand{\\shortsolnum}[1]\n{\n\\renewenvironment{Solshort}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\color{violet}\\textbf{##1.}\n\\color{black}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\shortsol}[1]{\n\\scantokens{\n\\begin{solshort}\n#1\n\\end{solshort}}\n}\n%Trích dẫn nguồn\n\\def\\labelex{}\n\n\\newcommand{\\nameex}{Câu}\n%Dấu chấm, phảy sau mỗi phương án\n\\def\\dotEX{.}\n%Tương thích gói picinpar\n\\def\\picinpar{\\setlength{\\linewidth}{\\linewidth}}\n\\AtBeginEnvironment{window}{\\def\\picinpar{\\setlength{\\linewidth}{\\linewidth-\\picwd-\\lwindowsep-2\\fboxsep}}}\n%Tùy chọn lời giải\n\\newcommand{\\choicew}[1]{\\setlength{\\widthch}{#1}}\n\\newcommand{\\loigiai}[1]{\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n\\def\\colorEX{\\color{red}}\n\\newcounter{numTrue}\n\\newcounter{numTrueSol}\n\\DeclareOption{solcolor}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\setbox1=\\hbox{#2}%\n\\def\\sizeboxEX{#1}%\n\\ \\EXbox{#2}\\ %\n}\n\\renewcommand{\\sh}[1]{#1}\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\squareEX{\\textbf{\\Alph{dapan}}}}}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\circled{\\textbf{\\Alph{dapan}}}}}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\leavevmode\\colorEX\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n#1%\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\leavevmode\\unskip\\selectA\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\leavevmode\\unskip\\selectB\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\leavevmode\\unskip\\selectC\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\leavevmode\\unskip\\selectD\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\leavevmode\\unskip\\selectE\\ignorespaces\n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n{}\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n}\n\\DeclareOption{loigiai}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\setbox1=\\hbox{#2}%\n\\def\\sizeboxEX{#1}%\n\\ \\EXbox{#2}\\ %\n}\n\\renewcommand{\\sh}[1]{#1}\n%%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\color{blue}{\\bf \\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n#1%\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\leavevmode\\unskip\\selectA\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\leavevmode\\unskip\\selectB\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\leavevmode\\unskip\\selectC\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\leavevmode\\unskip\\selectD\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\leavevmode\\unskip\\selectE\\ignorespaces\n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n{}\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n}\n\\DeclareOption{color}{\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\squareEX{\\textbf{\\Alph{dapan}}}}}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\circled{\\textbf{\\Alph{dapan}}}}}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\colorEX{\\color{red}}\n\\def\\True{\\leavevmode\\colorEX\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n}\n\\DeclareOption{book}{\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n\\makeatletter\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\ifnum\\the\\value{numTrueSol}=1\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectA\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectB\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectC\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectD\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectE\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=0\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\setcounter{numTrueSol}{0}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}} \n}\n\\DeclareOption{dethi}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\def\\sizeboxEX{#1}%\n\\setbox1=\\hbox{#2}%\n\\ \\EXbox{}\\ %\n}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}} \n}\n\\ExecuteOptions{dethi}\n\\ProcessOptions\n%Nội dung gói ex_test\n\\theorempreskipamount0.1\\baselineskip\n\\theorempostskipamount0.2\\baselineskip\n\\newlength\\dorongfix\n\\dorongfix=\\linewidth\n\\newlength\\dorong\n\\dorong=\\linewidth\n\\makeatletter\n\\newtheoremstyle{exbreak}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]}%\n{\\item\\hbox to \\linewidth{\\theorem@headerfont ##1\\ ##2\\\n(##3)\\theorem@separator\\hfill}}\n\\newtheoremstyle{explain}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]\\def\\labelex{\n\\begin{flushright}\n\\vspace*{-5pt}\n\\textit{\\textbf{(##3)}}\n\\vspace*{-5pt}\n\\end{flushright}}}\n%Danh sách môi trường trích dẫn nguồn câu hỏi\n\\newcommand{\\listtheorem}[1]{\n\\foreach \\x in {#1} {%môi trường\n\\AtEndEnvironment{\\x}{\n\\labelex\n}}}\n\\makeatother\n%\\theoremstyle{explain}\n\\theoremseparator{.}\n\\theorembodyfont{\\rm}\n\\Newassociation{solbook}{Solbook}{ansbook}\n\\renewcommand{\\Solbooklabel}[1]{\\textbf{\\nameex\\ #1.}\n}\n\\Newassociation{EXsol}{Solution}{ans}\n\\Newassociation{sol}{Solution}{ans_old}\n\\newtheorem{ex}{\\nameex}\n\\AtBeginEnvironment{Solbook}{\n\\renewcommand{\\IMleftright}[3]{\n\\par\\noindent\n\\begin{minipage}[t][][t]{\\linewidth-\\widthimmini-4\\fboxsep-#1\\linewidth}\n#2\n\\end{minipage}\n\\hspace{#1\\linewidth}\\hspace{2\\fboxsep}\n\\begin{minipage}[t][][b]{\\widthimmini}\\vspaceIM\n#3\n\\end{minipage}\n\\par\\nointerlineskip\n}\n}\n\\AtBeginEnvironment{ex}{\n\\setcounter{numTrueSol}{0}\n\\def\\dotEX{.}\n\\setcounter{numChoice}{0}\n}\n\\AtEndEnvironment{ex}{\n\\ifnum\\the\\value{numTrue}=1\n\\scantokens{\\begin{EXsol}A\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=2\n\\scantokens{\\begin{EXsol}B\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=3\n\\scantokens{\\begin{EXsol}C\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=4\n\\scantokens{\\begin{EXsol}D\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=5\n\\scantokens{\\begin{EXsol}E\\end{EXsol}}\n\\fi\n\\setcounter{numTrue}{0}\n\\setcounter{numTrueSol}{0}\n\\labelex\n}\n\\newtheorem{vdex}{Ví dụ}\n\\AtBeginEnvironment{vdex}{\\setcounter{numTrueSol}{0}\\def\\dotEX{.}}\n\\newcommand{\\boncot}[4]{\n\\picinpar\n\\setlength{\\dorong}{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\haicot}[4]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\motcot}[4]{\n\\picinpar\n\\setlength{\\dorong}{\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#2\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\\strut\n\\end{minipage}\n\n}\n%%%%%%%Tự động chọn \\motcot, \\haicot, \\boncot\n\\newlength\\widthcha\n\\newlength\\widthchb\n\\newlength\\widthchc\n\\newlength\\widthchd\n\\newlength\\widthche\n\\newlength\\widthch\n\\newlength\\tabmaxwidth\n\\newlength\\fourthtabwidth\n\\newlength\\halftabwidth\n\\newlength\\fifthtabwidth\n\\newlength\\thirdtabwidth\n\\newcommand{\\choice}[4]{%\n\\setlength\\tabmaxwidth{\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\halftabwidth{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\settowidth\\widthcha{#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\settowidth\\widthchb{#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\settowidth\\widthchc{#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\settowidth\\widthchd{#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\widthch<\\fourthtabwidth\n\\boncot{#1}{#2}{#3}{#4}\n\\else\\ifdim\\widthch<\\halftabwidth\n\\haicot{#1}{#2}{#3}{#4}\n\\else\n\\motcot{#1}{#2}{#3}{#4}\n\\fi\\fi\n}\n\\newcommand{\\choicefix}[4]{%\n\\setlength\\tabmaxwidth{\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\halftabwidth{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\settowidth\\widthcha{#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\settowidth\\widthchb{#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\settowidth\\widthchc{#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\settowidth\\widthchd{#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\widthch<\\fourthtabwidth\n\\boncot{#1}{#2}{#3}{#4}\n\\else\\ifdim\\widthch<\\halftabwidth\n\\haicot{#1}{#2}{#3}{#4}\n\\else\n\\motcot{#1}{#2}{#3}{#4}\n\\fi\\fi\n}\n%Trắc nghiệm 5 lựa chọn\n\\newcommand{\\nammot}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.2\\linewidth-0.022\\dorongfix-2\\fboxsep-\\widthalpha}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#5\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\bahai}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\fboxsep-3\\widthalpha}\n\\setcounter{dapan}{0}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapanhaiba\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#3\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#5\\dotEX\n\\end{minipage}\n\n}\n\n\\newcommand{\\haiba}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\fboxsep-3\\widthalpha}\n\\setcounter{dapan}{0}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapanhaiba\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#5\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\motnam}[5]{\n\\picinpar\n\\setlength{\\dorong}{\\linewidth-0.02\\dorongfix-\\fboxsep-2\\widthalpha}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#2\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#5\\dotEX\\strut\n\\end{minipage}\n\n}\n\\newlength\\wmothai\n\\newlength\\wmothaiba\n\\newlength\\wmothaibabon\n\\newlength\\wbonnam\n\\newlength\\wbabonnam\n\\newlength\\whaibabonnam\n\\newcounter{numChoice}\n\\newcommand{\\choicefive}[5]{%\n\\setlength\\tabmaxwidth{\\linewidth-\\picwd-\\lwindowsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.25\\picwd-0.25\\lwindowsep-\\widthalpha}\n\\setlength\\halftabwidth{0.5\\linewidth-0.5\\picwd-0.5\\lwindowsep-\\widthalpha}\n\\setlength\\fifthtabwidth{0.2\\linewidth-0.2\\picwd-0.2\\lwindowsep-\\widthalpha}\n\\setlength\\thirdtabwidth{0.33\\linewidth-0.33\\picwd-0.33\\lwindowsep-\\widthalpha}\n\\settowidth\\widthcha{AM.#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\ifdim\\wmothai<\\widthcha\\relax\\setlength{\\wmothai}{\\widthcha}\\fi%\n\\ifdim\\wmothaiba<\\widthcha\\relax\\setlength{\\wmothaiba}{\\widthcha}\\fi%\n\\ifdim\\wmothaibabon<\\widthcha\\relax\\setlength{\\wmothaibabon}{\\widthcha}\\fi%\n\\settowidth\\widthchb{BM.#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\ifdim\\wmothai<\\widthchb\\relax\\setlength{\\wmothai}{\\widthchb}\\fi%\n\\ifdim\\wmothaiba<\\widthchb\\relax\\setlength{\\wmothaiba}{\\widthchb}\\fi%\n\\ifdim\\wmothaibabon<\\widthchb\\relax\\setlength{\\wmothaibabon}{\\widthchb}\n\\fi%\n\\ifdim\\whaibabonnam<\\widthchb\\relax\\setlength{\\whaibabonnam}{\\widthchb}\n\\fi%\n\\settowidth\\widthchc{CM.#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\ifdim\\wmothaiba<\\widthchc\\relax\\setlength{\\wmothaiba}{\\widthchc}\\fi%\n\\ifdim\\wmothaibabon<\\widthchc\\relax\\setlength{\\wmothaibabon}{\\widthchc}\\fi%\n\\ifdim\\wbabonnam<\\widthchc\\relax\\setlength{\\wbabonnam}{\\widthchc}\\fi%\n\\ifdim\\whaibabonnam<\\widthchc\\relax\\setlength{\\whaibabonnam}{\\widthchc}\n\\fi%\n\\settowidth\\widthchd{DM.#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\wmothaibabon<\\widthchd\\relax\\setlength{\\wmothaibabon}{\\widthchd}\\fi%\n\\ifdim\\wbabonnam<\\widthchd\\relax\\setlength{\\wbabonnam}{\\widthchd}\\fi%\n\\ifdim\\wbonnam<\\widthchd\\relax\\setlength{\\wbonnam}{\\widthchd}\\fi%\n\\ifdim\\whaibabonnam<\\widthchd\\relax\\setlength{\\whaibabonnam}{\\widthchd}\n\\fi%\n\\settowidth\\widthche{EM.#5}%\n\\ifdim\\widthch<\\widthche\\relax\\setlength{\\widthch}{\\widthche}\\fi%\n\\ifdim\\wbabonnam<\\widthche\\relax\\setlength{\\wbabonnam}{\\widthche}\\fi%\n\\ifdim\\wbonnam<\\widthche\\relax\\setlength{\\wbonnam}{\\widthche}\\fi%\n\\ifdim\\whaibabonnam<\\widthchd\\relax\\setlength{\\whaibabonnam}{\\widthchd}\n\\fi%\n%Khởi tạo điều kiện \n\\setcounter{numChoice}{0}\n\\ifdim\\wmothai<\\halftabwidth\n\\ifdim\\wbabonnam<\\thirdtabwidth \n\\setcounter{numChoice}{1}\n\\fi\\fi\n\\ifdim\\wmothaiba<\\thirdtabwidth \n\\ifdim\\wbonnam<\\halftabwidth\n\\setcounter{numChoice}{2}\n\\fi\\fi\n\\ifdim\\widthch<\\fifthtabwidth\n\\setcounter{numChoice}{3}\n\\fi\n%Lựa chọn cách sắp xếp\n\\ifnum\\the\\value{numChoice}=3\n\\nammot{#1}{#2}{#3}{#4}{#5}\n\\else\n\\ifnum\\the\\value{numChoice}=2\n\\bahai{#1}{#2}{#3}{#4}{#5}\n\\else\n\\ifnum\\the\\value{numChoice}=1\n\\haiba{#1}{#2}{#3}{#4}{#5}\n\\else\n\\motnam{#1}{#2}{#3}{#4}{#5}\n\\fi\\fi\\fi\n}\n%HẾT trắc nghiệm 5 lựa chọn\n%Các phương pháp đưa hình vào văn bản\n\\def\\vspaceIM{\\vspace{-13pt}}\n\\def\\breakIM{}\n\\def\\numpicinpar{0}\n\\newdimen\\widthimmini\n\\newdimen\\heightimmini\n\\newdimen\\spaceleft\n\\newbox\\imbox\n\\newcommand{\\hspaceIM}[1]{\n\\def\\hspaceIMEX{\\hspace{#1\\linewidth}}\n\\def\\hspaceEXIM{#1\\linewidth}\n}\n\\newcommand{\\IMleftright}[3]{\n\\hfill\\par\\noindent\n\\begin{minipage}[t][][t]{\\linewidth-\\widthimmini-4\\fboxsep-#1\\linewidth}\n#2\n\\end{minipage}\n\\hspace{#1\\linewidth}\\hspace{2\\fboxsep}\n\\begin{minipage}[t][][b]{\\widthimmini}\\vspaceIM\n#3\n\\end{minipage}\n\\par\\nointerlineskip\n}\n\\newcommand{\\immini}[3][0]{\n\\setbox\\imbox=\\vbox{\\hbox{#3}}\n\\widthimmini=\\wd\\imbox\n\\heightimmini=\\ht\\imbox\n\\spaceleft=\\dimexpr\\textheight-\\pagetotal-2\\baselineskip\\relax\n\\ifdim\\heightimmini>\\spaceleft\n\\breakIM\n\\fi\n\\IMleftright{#1}{#2}{#3}\n}\n\\newcommand{\\impicinpar}[2]{\n\\begin{window}[\\numpicinpar,r,{\n#2\n}, {}]\n\\begin{flushleft}\n#1\n\\end{flushleft}\n\\end{window}\n}\n%Hết cách đưa hình vào văn bản\n\n% Biểu diễn khoảng, đoạn trên trục số\n\\usetikzlibrary{decorations.pathreplacing,decorations.markings,patterns}\n\\def\\colorInterval{black}\n\\def\\skipInterval{0.4cm}\n\\newcommand{\\Interval}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw[color=\\colorInterval] decorate[decoration={ticks,amplitude=3pt,segment length=1mm}] {(a)--(b)};\n}\n\\newcommand{\\IntervalR}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,-3pt) -- (3pt,3pt);\n}}] {(a)--(b)};\n}\n\\newcommand{\\IntervalL}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw decorate[decoration={\nmarkings,\nmark=between positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,3pt) -- (3pt,-3pt);\n}\n}\n] {(a)--(b)};\n}\n\\newcommand{\\IntervalLF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\fill[pattern=north west lines,pattern color=\\colorInterval](#2,-3pt)rectangle(#4,3pt);\n}\n\\newcommand{\\IntervalRF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\fill[pattern=north east lines,pattern color=\\colorInterval](#2,-3pt)rectangle(#4,3pt);\n}\n\\def\\pre{0}\n\\def\\next{2}\n\\newcommand{\\IntervalLR}[2]{\n\\def\\pre{#1}\n\\def\\next{#2}\n}\n\\newcommand{\\IntervalG}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw[color=\\colorInterval] decorate[decoration={ticks,amplitude=3pt,segment length=1mm}] {(a)--(b)};\n}\n\\newcommand{\\IntervalGL}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,3pt) -- (3pt,-3pt);\n}}] {(a)--(b)};\n}\n\\newcommand{\\IntervalGR}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,-3pt) -- (3pt,3pt);\n}}] {(a)--(b)};\n}\n\n\\newcommand{\\IntervalGLF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\fill[pattern=north west lines,pattern color=\\colorInterval](\\pre,-3pt)rectangle(\\next,3pt);\n}\n\\newcommand{\\IntervalGRF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\fill[pattern=north east lines,pattern color=\\colorInterval](\\pre,-3pt)rectangle(\\next,3pt);\n}\n%Định nghĩa dots fill\n\\newcommand{\\dotlineEX}[1]{\n\\def\\numlinedot{#1}\n\\par\n\\foreach \\dotline in{1,...,\\numlinedot}\n{\n\\noindent\\dotfill\n\\par\n}\n}\n%Liệt kê danh sách đáp án\n\\newsavebox{\\myboxans}\n\\newcommand{\\boxans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{lrbox}{\\myboxans}\\begin{minipage}{0.1\\linewidth-4\\fboxsep}\n\\parbox[b]{0.55\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}\\end{lrbox}\\fbox{\\usebox{\\myboxans}}}\n}\n\\newcommand{\\listans}\n{\n\\renewenvironment{Solution}[1]\n{{\\color{blue}##1}\\hspace*{-4pt}}\n{\\hspace*{-5pt}}\n}\n\\newcommand{\\tabans}[1]\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.1\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\inputans}[2]{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n\\begin{flushleft}\n\\input{#2} \n\\end{flushleft}\n}\n\\newcommand{\\inputansbox}[2]{\n\\renewenvironment{Solution}[1]\n{\\begin{lrbox}{\\myboxans}\\begin{minipage}{\\linewidth/#1-4\\fboxsep}\n\\parbox[b]{0.55\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}\\end{lrbox}\\fbox{\\usebox{\\myboxans}}}\n\\begin{flushleft}\n\\input{#2} \n\\end{flushleft}\n}\n\\makeatletter\n\\@ifclasswith{article}{a5paper}\n{%\n\\renewcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.2\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n}{%\n}\n\\@ifclasswith{book}{a5paper}\n{%\n\\renewcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.2\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n}{%\n}\n\\makeatother\n%Hỗ trợ gói ex_test_rd\n\\newenvironment{fileEX}{\\filecontents}{\\endfilecontents}\n\\newcommand{\\bankEX}[2]{\n\\input{#1}\n}\n\\newtheorem{exrd}{Câu}\n\\def\\listfile{\n\\bankEX{onefile.tex}{50}\n}\n\\def\\testname{\n\\begin{center}\n\\textbf{ĐỀ THI MẪU}\n\\end{center}\n\\rightline{\n\\setlength\\fboxrule{2pt} \n\\setlength\\fboxsep{5pt} \n\\fbox{\\textbf{Mã đề thi\\ \\x}}\n}\n}\n\\newcommand{\\randombank}[1]{\n%\\testname\n\\begin{center}\n\\textbf{\n\\color{red}\nBạn đang chạy bằng gói ex\\_test xuất ra MỌI CÂU HỎI của ngân hàng nhằm soát lỗi.\\\\\nKhi mọi thứ đã OK, hãy thay khai báo gói ex\\_test bằng gói ex\\_test\\_rd\n}\n\\end{center}\n\\Opensolutionfile{ans}[ans/ans_ex_test]\n\\listfile\n\\Closesolutionfile{ans}\n}\n\\newcommand{\\showansfull}{\\par Các mã đề: }\n\\newcommand{\\showans}{\\par Các mã đề: }\n%Đường tròn LG\n\\usetikzlibrary{plotmarks}\n\\newcommand{\\trucLG}{\n\\draw[->] (0,-1.3) -- (0,1.3) node[left] {$\\sin$};\n\\draw[->] (-1.3,0) -- (1.3,0) node[below] {$\\cos$};\n\\draw (0,0) circle (1cm);\n}\n\\newcommand{\\pointLG}[4]\n{\n\\foreach \\i in {0,...,#2}\n{\n\\draw[color=#4]\nplot[mark=#3] coordinates {({#1+\\i*360/#2}:1)};\n}\n}\n\\makeatletter\n\\def\\sizeboxEX{9pt}\n\\def\\EXbox#1{%\n\\begingroup%\n\\setlength{\\fboxsep}{0.3ex}%\n\\setlength{\\@tempdima}{\\sizeboxEX}%\n\\setlength{\\@tempdimb}{(\\@tempdima-\\ht1+\\dp1)/2}%\n\\raise-\\@tempdimb\\hbox{\\fbox{\\vbox to \\@tempdima{%\n\\vfil\\hbox to \\@tempdima{\\hfil#1\\hfil}\\vfil}}}%\n\\endgroup%\n}\n\\def\\EXboxTF#1{%\n\\begingroup%\n\\setlength{\\fboxsep}{0.3ex}%\n\\setbox1=\\hbox{#1}%\n\\setlength{\\@tempdima}{\\sizeboxEX}%\n\\fbox{\\vbox to \\@tempdima{%\n\\vfil\\hbox to \\@tempdima{\\hfil\\copy1\\hfil}\\vfil}}%\n\\endgroup%\n}\n\\makeatother\n% Môi trường liệt kê dàn theo nhiều dòng khác nhau\n\\ExplSyntaxOn\n% variants of kernel functions:\n\\cs_generate_variant:Nn \\tl_if_eq:nnTF { V }\n\\cs_generate_variant:Nn \\tl_if_eq:nnT { V }\n\n% --------------------------------------------------------------------------\n% variables:\n\\seq_new:N \\l__listsEX_seq\n\n\\int_new:N \\l__listsEX_depth_int\n\\int_new:N \\g__listsEX_int\n\\int_new:N \\g__listsEX_total_items_int\n\\int_new:N \\l__listsEX_columns_int\n\\int_new:N \\l__listsEX_rows_int\n\\int_new:N \\g__listsEX_current_col_num_int\n\\int_new:N \\g__listsEX_current_row_num_int\n\\int_new:N \\l__listsEX_item_columns_int\n\n\\bool_new:N \\l__listsEX_enumerate_bool\n\\bool_new:N \\l__listsEX_resume_bool\n\\bool_new:N \\l__listsEX_load_listsEX_bool\n\\bool_new:N \\l__listsEX_label_width_bool\n\\bool_new:N \\l__listsEX_item_indent_bool\n\\bool_new:N \\l__listsEX_label_offset_bool\n\\bool_new:N \\l__listsEX_custom_label_bool\n\\bool_new:N \\l__listsEX_custom_after_item_skip_bool\n\\bool_new:N \\l__listsEX_debug_bool\n\\bool_new:N \\l__listsEX_item_full_line_bool\n\\bool_new:N \\l__listsEX_item_rest_of_line_bool\n\n\\tl_new:N \\l__listsEX_instance_tl\n\\tl_new:N \\l__listsEX_label_tl\n\\tl_new:N \\l__listsEX_custom_label_tl\n\\tl_new:N \\l__listsEX_label_pattern_tl\n\\tl_new:N \\l__listsEX_custom_label_pattern_tl\n\\tl_new:N \\l__listsEX_label_format_tl\n\\tl_new:N \\l__listsEX_custom_label_format_tl\n\\tl_new:N \\l__listsEX_item_format_tl\n\\tl_new:N \\l__listsEX_custom_item_format_tl\n\\tl_new:N \\l__listsEX_item_fill_left_tl\n\\tl_new:N \\l__listsEX_item_fill_right_tl\n\\tl_new:N \\l__listsEX_label_align_tl\n% \\tl_new:N \\listEX\n\\tl_new:N \\l__listsEX_item_tl\n\\tl_new:N \\l__listsEX_tmp_label_tl\n\n\\dim_new:N \\l__listsEX_item_indent_dim\n\\dim_new:N \\l__listsEX_item_default_indent_dim\n\\dim_new:N \\l__listsEX_item_width_dim\n\\dim_new:N \\l__listsEX_label_width_dim\n\\dim_new:N \\l__listsEX_label_default_width_dim\n\\dim_new:N \\l__listsEX_label_offset_dim\n\\dim_new:N \\l__listsEX_label_default_offset_dim\n\\dim_new:N \\l__listsEX_column_sep_dim\n\n\\skip_new:N \\l__listsEX_after_item_skip\n\\skip_new:N \\l__listsEX_custom_after_item_skip\n\\skip_new:N \\l__listsEX_before_list_skip\n\\skip_new:N \\l__listsEX_after_list_skip\n\n\\coffin_new:N \\l__listsEX_item_coffin\n\\coffin_new:N \\l__listsEX_label_coffin\n\n\\NewCounterPattern* [ listsEX ] { listEX } { tsk }\n\\ReadCounterFrom [ listsEX ] { listEX } \\g__listsEX_int\n\n% temporary variables:\n\\int_new:N \\l__listsEX_tmpa_int\n\\int_new:N \\l__listsEX_tmpb_int\n\\tl_new:N \\l__listsEX_tmpa_tl\n\\coffin_new:N \\l__listsEX_tmpa_coffin\n\n\\cs_new:Npn \\__listsEX_debug:n #1\n{\n\\bool_if:NTF \\l__listsEX_debug_bool\n{ \\fbox {#1} }\n{ \\use:n {#1} }\n}\n\n% --------------------------------------------------------------------------\n% collect the listsEX:\n\\cs_new_protected:Npn \\__listsEX_collect_listsEX:nww #1#2 \\end #3\n{\n\\tl_put_right:Nn \\l__listsEX_body_tl {#1}\n\\end {#3}\n\\tl_if_eq:nnF {#1} {#3}\n{ \\__listsEX_collect_listsEX:nww {#1} }\n}\n\n% #1: instance\n% #2: number of columns\n% #3: item separator\n% #4: environment body\n\\cs_new_protected:Npn \\__listsEX:nnnn #1#2#3#4\n{\n\\bool_if:NT \\l__listsEX_debug_bool { \\dim_set:Nn \\fboxsep {0pt} }\n\\seq_set_split:Nnn \\l__listsEX_seq {#3} {#4}\n% remove the first (empty) item:\n\\seq_pop_left:NN \\l__listsEX_seq \\l__listsEX_tmpa_tl\n\\tl_if_blank:VF \\l__listsEX_tmpa_tl { \\@noitemerr }\n\\int_gset:Nn \\g__listsEX_total_items_int\n{ \\seq_count:N \\l__listsEX_seq }\n\\UseInstance {listsEX} {#1}\n{ \\g__listsEX_total_items_int }\n{#2}\n{ \\l__listsEX_custom_label_pattern_tl }\n% just to be sure:\n\\seq_clear:N \\l__listsEX_seq\n}\n\\cs_generate_variant:Nn \\__listsEX:nnnn { VnnV }\n\n% #1: label\n% #2: item format\n% #3: item\n\\cs_new_protected:Npn \\__listsEX_listEX:nnn #1#2#3\n{\n% start a new item line if \\l__listsEX_item_full_line_bool\n\\bool_if:NT \\l__listsEX_item_full_line_bool\n{\n% add skip if we were in the middle of a line, i.e., in horizontal\n% mode:\n\\mode_if_horizontal:T\n{ \\skip_vertical:N \\l__listsEX_after_item_skip }\n\\listsEX_new_row:\n}\n% step column position:\n\\int_gincr:N \\g__listsEX_current_col_num_int\n\\dim_set:Nn \\l__listsEX_item_width_dim\n{\n\\bool_if:NTF \\l__listsEX_item_full_line_bool\n{ \\linewidth }\n{\n(\n\\linewidth\n-\\fboxsep \n- \\l__listsEX_columns_int \\l__listsEX_column_sep_dim\n+ \\l__listsEX_column_sep_dim\n) / \\l__listsEX_columns_int\n}\n- \\l__listsEX_depth_int \\l__listsEX_item_indent_dim\n\\bool_if:NT \\l__listsEX_debug_bool { -2\\fboxrule }\n}\n\\__listsEX_gset_rows_num:NN\n\\g__listsEX_total_items_int\n\\l__listsEX_columns_int\n% set \\g__listsEX_current_col_num_int to 1 if at the start of a row,\n% then also step \\g__listsEX_current_row_num_int :\n\\int_compare:nNnT\n{ \\g__listsEX_current_col_num_int } > { \\l__listsEX_columns_int }\n{\n\\int_gset:Nn \\g__listsEX_current_col_num_int { 1 }\n\\int_incr:N \\g__listsEX_current_row_num_int\n}\n\\bool_if:NT \\l__listsEX_item_rest_of_line_bool\n{\n\\int_set:Nn \\l__listsEX_tmpa_int\n{ \\l__listsEX_columns_int - \\g__listsEX_current_col_num_int + 1 }\n\\int_compare:nNnTF { \\l__listsEX_item_columns_int } = { 0 }\n{\n\\int_set:Nn \\l__listsEX_tmpb_int { \\l__listsEX_tmpa_int - 1 } % 8\n}\n{\n\\int_compare:nNnTF\n{ \\l__listsEX_tmpa_int } > { \\l__listsEX_item_columns_int }\n{ \\int_set_eq:NN \\l__listsEX_tmpa_int \\l__listsEX_item_columns_int }\n{ \\int_zero:N \\l__listsEX_item_columns_int }\n\\bool_if:nT\n{\n\\l__listsEX_item_rest_of_line_bool &&\n!\\int_compare_p:nNn { \\l__listsEX_item_columns_int} = { 0 }\n}\n{\n\\int_gadd:Nn \\g__listsEX_current_col_num_int\n{ \\l__listsEX_item_columns_int -1 }\n\\int_gadd:Nn \\g__listsEX_total_items_int\n{ \\l__listsEX_item_columns_int -1 }\n}\n\\int_set:Nn \\l__listsEX_tmpb_int { \\l__listsEX_tmpa_int -1 }\n}\n\\dim_set:Nn \\l__listsEX_item_width_dim\n{\n\\l__listsEX_tmpa_int \\l__listsEX_item_width_dim\n+ \\l__listsEX_tmpb_int \\l__listsEX_column_sep_dim\n+ \\l__listsEX_tmpb_int \\l__listsEX_item_indent_dim\n\\bool_if:NT \\l__listsEX_debug_bool\n{ + \\int_eval:n { \\l__listsEX_tmpb_int * 2 } \\fboxrule }\n}\n}\n% set the item box:\n\\hcoffin_set:Nn \\l__listsEX_item_coffin\n{\n\\vcoffin_set:Nnn \\l__listsEX_tmpa_coffin\n{ \\l__listsEX_item_width_dim }\n{ \\__listsEX_setup: #2 {#3} \\strut }\n\\__listsEX_debug:n\n{\n\\coffin_typeset:Nnnnn \\l__listsEX_tmpa_coffin\n{l} {T} {0pt} {0pt}\n}\n}\n% set the label box:\n\\hcoffin_set:Nn \\l__listsEX_label_coffin\n{\n\\vcoffin_set:Nnn \\l__listsEX_tmpa_coffin\n{\n\\l__listsEX_label_width_dim\n\\bool_if:NT \\l__listsEX_debug_bool {-2\\fboxrule }\n}\n{\n\\noindent\n\\tl_use:N \\l__listsEX_item_fill_left_tl\n\\strut #1\n\\tl_use:N \\l__listsEX_item_fill_right_tl\n}\n\\__listsEX_debug:n\n{\n\\coffin_typeset:Nnnnn \\l__listsEX_tmpa_coffin\n{l} {T} {0pt} {0pt}\n}\n}\n% attach the label box at the left of the item box, shifted by\n% \\l__listsEX_label_offset_dim :\n\\coffin_attach:NnnNnnnn\n\\l__listsEX_item_coffin {l} {T}\n\\l__listsEX_label_coffin {l} {T}\n{\n\\dim_compare:nNnTF\n{ \\l__listsEX_item_indent_dim }\n<\n{ \\l__listsEX_label_offset_dim + \\l__listsEX_label_width_dim }\n{0pt}\n{ - \\l__listsEX_label_width_dim - \\l__listsEX_label_offset_dim }\n} { 0pt }\n% when a new row starts enter vertical mode:\n\\int_compare:nNnT { \\g__listsEX_current_col_num_int } = { 1 }\n{ \\skip_vertical:N \\c_zero_skip }\n% skip horizontally by \\l__listsEX_item_indent_dim\n\\noindent\n\\skip_horizontal:N \\l__listsEX_item_indent_dim\n% typeset the item (with the attached label protruding to the left):\n\\coffin_typeset:Nnnnn \\l__listsEX_item_coffin\n{l}\n{T}\n{0pt}\n{0pt}\n\\bool_if:nT\n{\n\\l__listsEX_item_full_line_bool ||\n(\n\\l__listsEX_item_rest_of_line_bool &&\n\\int_compare_p:nNn { \\l__listsEX_item_columns_int } = { 0 }\n)\n}\n{ \\listsEX_new_row: }\n% are we between items in a row? The skip by \\l__listsEX_column_sep_dim :\n\\int_compare:nNnT\n{ \\g__listsEX_current_col_num_int } < { \\l__listsEX_columns_int }\n{ \\skip_horizontal:N \\l__listsEX_column_sep_dim }\n% if we ended a row and a new row is still to come skip vertically by\n% \\l__listsEX_after_item_skip :\n\\bool_if:nT\n{\n( \\int_compare_p:nNn { \\g__listsEX_current_col_num_int } = { \\l__listsEX_columns_int } )\n&&\n( \\int_compare_p:n { \\g__listsEX_current_row_num_int != \\l__listsEX_rows_int } )\n}\n{ \\skip_vertical:N \\l__listsEX_after_item_skip }\n% clean up:\n\\coffin_clear:N \\l__listsEX_item_coffin\n\\coffin_clear:N \\l__listsEX_label_coffin\n\\coffin_clear:N \\l__listsEX_tmpa_coffin\n\\bool_set_false:N \\l__listsEX_item_full_line_bool\n\\bool_set_false:N \\l__listsEX_item_rest_of_line_bool\n}\n\\cs_generate_variant:Nn \\__listsEX_listEX:nnn { VVV }\n\n\\cs_new_protected:Npn \\__listsEX_setup:\n{\n\\dim_set:Nn \\parskip { 0pt }\n\\skip_set:Nn \\parfillskip { 0pt plus 1fil }\n\\dim_set_eq:NN \\parskip \\parsep\n\\dim_set_eq:NN \\parindent \\listparindent\n\\noindent\n\\dim_compare:nNnT\n{ \\l__listsEX_item_indent_dim }\n<\n{ \\l__listsEX_label_offset_dim + \\l__listsEX_label_width_dim }\n{\n\\skip_horizontal:n\n{\n\\l__listsEX_label_offset_dim\n+ \\l__listsEX_label_width_dim\n- \\l__listsEX_item_indent_dim\n}\n}\n\\strut\n}\n\n\\cs_new_protected:Npn \\__listsEX_gset_rows_num:NN #1#2\n{\n\\int_gset:Nn \\l__listsEX_rows_int { \\int_div_truncate:nn {#1} {#2} }\n\\int_compare:nNnT { \\int_mod:nn {#1} {#2} } > { 0 }\n{ \\int_gincr:N \\l__listsEX_rows_int }\n}\n\n\\cs_new_protected:Npn \\__listsEX_label_align:n #1\n{\n\\str_case:nnF {#1}\n{\n{left}\n{\n\\tl_clear:N \\l__listsEX_item_fill_left_tl\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n{right}\n{\n\\tl_set_eq:NN \\l__listsEX_item_fill_left_tl \\hfill\n\\tl_clear:N \\l__listsEX_item_fill_right_tl\n}\n{center}\n{\n\\tl_set_eq:NN \\l__listsEX_item_fill_left_tl \\hfill\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n}\n{\n\\tl_clear:N \\l__listsEX_item_fill_left_tl\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n}\n\\cs_generate_variant:Nn \\__listsEX_label_align:n { V }\n\\__listsEX_label_align:n {left}\n\n% --------------------------------------------------------------------------\n% the ‘listsEX' object:\n% #1: number of items\n% #2: number of columns\n% #3: label-format\n\\DeclareObjectType {listsEX} {3}\n% the ‘default' template interface:\n\\DeclareTemplateInterface {listsEX} {default} {3}\n{\nenumerate : boolean = true ,\nlabel : tokenlist ,\nindent : length = 2.5em ,\ncounter-format : tokenlist = tsk[a]) ,\nlabel-format : tokenlist ,\nlabel-width : length = 1em ,\nlabel-offset : length = .3333em ,\nitem-format : tokenlist ,\nafter-item-skip : skip = 1ex plus 1ex minus 1ex\n}\n\n% in the next three commands we want a really unlikely to occur marker; for\n% this we use $ with unusual catcode in ‘‘$listsEX$default$label$'':\n\\cs_set:Nx \\__listsEX_restore_dollar:\n{ \\char_set_catcode:nn {36} { \\char_value_catcode:n {36} } }\n\\char_set_catcode_alignment:N \\$\n\n% the ‘default' template code:\n\\DeclareTemplateCode {listsEX} {default} {3}\n{\nenumerate = \\l__listsEX_enumerate_bool ,\nlabel = \\l__listsEX_label_tl ,\nindent = \\l__listsEX_item_default_indent_dim ,\ncounter-format = \\l__listsEX_label_pattern_tl ,\nlabel-format = \\l__listsEX_label_format_tl ,\nlabel-width = \\l__listsEX_label_default_width_dim ,\nlabel-offset = \\l__listsEX_label_default_offset_dim ,\nitem-format = \\l__listsEX_item_format_tl ,\nafter-item-skip = \\l__listsEX_after_item_skip\n}\n{\n\\AssignTemplateKeys\n\\bool_if:NF \\l__listsEX_label_width_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_label_width_dim\n\\l__listsEX_label_default_width_dim\n}\n\\bool_if:NF \\l__listsEX_item_indent_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_item_indent_dim\n\\l__listsEX_item_default_indent_dim\n}\n\\bool_if:NF \\l__listsEX_label_offset_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_label_offset_dim\n\\l__listsEX_label_default_offset_dim\n}\n\\bool_if:NT \\l__listsEX_custom_after_item_skip_bool\n{\n\\skip_set_eq:NN\n\\l__listsEX_after_item_skip\n\\l__listsEX_custom_after_item_skip\n}\n\\bool_if:NT \\l__listsEX_custom_label_bool\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_tl\n\\l__listsEX_custom_label_tl\n\\bool_set_false:N \\l__listsEX_enumerate_bool\n}\n\\__listsEX_label_align:V \\l__listsEX_label_align_tl\n% need this for enumerate list:\n\\bool_if:nT { !\\l__listsEX_resume_bool && \\l__listsEX_enumerate_bool }\n{ \\int_gzero:N \\g__listsEX_int }\n\\int_set:Nn \\l__listsEX_columns_int {#2}\n% set all the items in their own coffins and join with the ground:\n\\int_gzero:N \\g__listsEX_current_col_num_int\n\\int_set:Nn \\g__listsEX_current_row_num_int {1}\n\\tl_if_blank:VF \\l__listsEX_custom_label_pattern_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_pattern_tl\n\\l__listsEX_custom_label_pattern_tl\n}\n\\tl_if_blank:VF \\l__listsEX_custom_label_format_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_format_tl\n\\l__listsEX_custom_label_format_tl\n}\n\\tl_if_blank:VF \\l__listsEX_custom_item_format_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_item_format_tl\n\\l__listsEX_custom_item_format_tl\n}\n\\seq_map_inline:Nn \\l__listsEX_seq\n{\n\\__listsEX_read_item:www ##1 \\q_stop\n\\bool_if:NTF \\l__listsEX_enumerate_bool\n{\n\\tl_if_eq:VnT \\l__listsEX_tmp_label_tl { $listsEX$default$label$ }\n{\n\\int_gincr:N \\g__listsEX_int\n\\SaveCounterPatternFrom [listsEX]\n\\l__listsEX_tmpa_tl\n\\l__listsEX_label_tl\n\\l__listsEX_label_pattern_tl\n}\n}\n{\n\\tl_if_blank:VT \\l__listsEX_label_tl\n{ \\tl_set_eq:NN \\l__listsEX_label_tl \\labelitemi }\n}\n\\tl_put_left:NV \\l__listsEX_label_tl \\l__listsEX_label_format_tl\n% \\tl_put_left:NV \\l__listsEX_item_tl \\l__listsEX_item_format_tl\n\\tl_if_eq:VnTF \\l__listsEX_tmp_label_tl { $listsEX$default$label$ }\n{\n\\__listsEX_listEX:VVV\n\\l__listsEX_label_tl\n\\l__listsEX_item_format_tl\n\\l__listsEX_item_tl\n}\n{\n\\__listsEX_listEX:VVV\n\\l__listsEX_tmp_label_tl\n\\l__listsEX_item_format_tl\n\\l__listsEX_item_tl\n\\tl_clear:N \\l__listsEX_tmp_label_tl\n}\n}\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item:www\n{\n\\peek_meaning_remove:NTF !\n{\n\\bool_set_true:N \\l__listsEX_item_full_line_bool\n\\__listsEX_read_item_aux:ww\n}\n{\n\\peek_meaning_remove:NTF *\n{\n\\bool_set_true:N \\l__listsEX_item_rest_of_line_bool\n\\__listsEX_read_item_rest_of_line:ww\n}\n{ \\__listsEX_read_item_aux:ww }\n}\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_rest_of_line:ww\n{\n\\peek_meaning:NTF ( % )\n{ \\__listsEX_read_item_rest_of_line_aux:ww }\n{ \\__listsEX_read_item_rest_of_line_aux:ww (0) }\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_rest_of_line_aux:ww (#1)\n{\n\\int_set:Nn \\l__listsEX_item_columns_int {#1}\n\\__listsEX_read_item_aux:ww\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_aux:ww\n{\n\\peek_meaning:NTF [ % ]\n{ \\__listsEX_read_item_aux_ii:ww }\n{ \\__listsEX_read_item_aux_ii:ww [$listsEX$default$label$] }\n}\n\\cs_new_protected:Npn \\__listsEX_read_item_aux_ii:ww [#1]#2 \\q_stop\n{\n\\tl_set:Nn \\l__listsEX_tmp_label_tl {#1}\n\\tl_if_eq:nnF { #1 } { $listsEX$default$label$ }\n{ \\tl_put_left:NV \\l__listsEX_tmp_label_tl \\l__listsEX_label_format_tl }\n\\tl_set:Nx \\l__listsEX_item_tl { \\tl_trim_spaces:n {#2} }\n}\n\n\\__listsEX_restore_dollar:\n\n% --------------------------------------------------------------------------\n% choice box:\n\\bool_new:N \\l__listsEX_choice_checked_bool\n\\dim_new:N \\l__listsEX_choice_width_dim\n\\dim_set:Nn \\l__listsEX_choice_width_dim { 1.25ex }\n\\dim_new:N \\l__listsEX_choice_linewidth_dim\n\\dim_set:Nn \\l__listsEX_choice_linewidth_dim { .3pt }\n\\dim_new:N \\l__listsEX_choice_checkwidth_dim\n\\dim_set:Nn \\l__listsEX_choice_checkwidth_dim { .5pt }\n\\dim_new:N \\l__listsEX_choice_raise_dim\n\\dim_set:Nn \\l__listsEX_choice_raise_dim { .1ex }\n\n\\cs_new_protected:Npn \\listsEX_choice:\n{\n\\leavevmode\n\\group_begin:\n\\bool_set_false:N \\l__listsEX_choice_checked_bool\n\\box_move_up:nn\n{ \\l__listsEX_choice_raise_dim }\n{ \\hbox:n { \\__listsEX_choice: } }\n\\group_end:\n}\n\n\\cs_new_protected:Npn \\listsEX_choice_checked:\n{\n\\leavevmode\n\\group_begin:\n\\bool_set_true:N \\l__listsEX_choice_checked_bool\n\\box_move_up:nn\n{ \\l__listsEX_choice_raise_dim }\n{ \\hbox:n { \\__listsEX_choice: } }\n\\group_end:\n}\n\n\\cs_new_protected:Npn \\__listsEX_choice:\n{%\n\\dim_set:Nn \\unitlength { .1\\l__listsEX_choice_width_dim }\n\\begin{picture}(10,0)\n\\linethickness \\l__listsEX_choice_linewidth_dim\n\\drawline(0,0)(0,10)(10,10)(10,0)(0,0)\n\\linethickness \\l__listsEX_choice_checkwidth_dim\n\\bool_if:NT \\l__listsEX_choice_checked_bool\n{\n\\drawline(2,2)(8,8)\n\\drawline(2,8)(8,2)\n}\n\\end{picture}%\n}\n\n\\providecommand* \\choicebox { \\listsEX_choice: }\n\\providecommand* \\checkedchoicebox { \\listsEX_choice_checked: }\n\n% --------------------------------------------------------------------------\n% base instance:\n% ALPHABETIZE: a) b) c)\n\\DeclareInstance {listsEX} {alphabetize} {default} { }\n\n\\keys_define:nn {listsEX/list}\n{\ndebug .bool_set:N = \\l__listsEX_debug_bool ,\nstyle .tl_set:N = \\l__listsEX_instance_tl ,\nstyle .initial:n = alphabetize ,\ncounter-format .tl_set:N = \\l__listsEX_custom_label_pattern_tl ,\nlabel .code:n =\n\\bool_set_true:N \\l__listsEX_custom_label_bool\n\\tl_set:Nn \\l__listsEX_custom_label_tl {#1} ,\nlabel-format .tl_set:N = \\l__listsEX_custom_label_format_tl ,\nlabel-width .code:n =\n\\dim_set:Nn \\l__listsEX_label_width_dim {#1}\n\\bool_set_true:N \\l__listsEX_label_width_bool ,\nlabel-offset .code:n =\n\\dim_set:Nn \\l__listsEX_label_offset_dim {#1}\n\\bool_set_true:N \\l__listsEX_label_offset_bool ,\nlabel-align .tl_set:N = \\l__listsEX_label_align_tl ,\nitem-format .tl_set:N = \\l__listsEX_custom_item_format_tl ,\nitem-indent .code:n =\n\\dim_set:Nn \\l__listsEX_item_indent_dim {#1}\n\\bool_set_true:N \\l__listsEX_item_indent_bool ,\ncolumn-sep .dim_set:N = \\l__listsEX_column_sep_dim ,\nbefore-skip .skip_set:N = \\l__listsEX_before_list_skip ,\nafter-skip .skip_set:N = \\l__listsEX_after_list_skip ,\nafter-item-skip .code:n =\n\\bool_set_true:N \\l__listsEX_custom_after_item_skip_bool\n\\skip_set:Nn \\l__listsEX_custom_after_item_skip {#1} ,\nresume .bool_set:N = \\l__listsEX_resume_bool\n}\n\n% --------------------------------------------------------------------------\n% the generic environment:\n\\NewEnviron {__listsEX_env:} [3]\n{\n\\if@inlabel\n\\noindent\\par\\nobreak\\vskip-\\parskip\\vskip-\\baselineskip\\hrule\\@height\\z@\n\\fi\n\\dim_compare:nNnF { \\l__listsEX_before_list_skip } = { 0pt }\n{ \\vspace {\\l__listsEX_before_list_skip} }\n\\list {}\n{\n\\keys_set:nn {listsEX/list} {#2}\n\\dim_set:Nn \\leftmargin {0pt}\n\\dim_set:Nn \\rightmargin {0pt}\n}\n\\item \\scan_stop:\n\\int_incr:N \\l__listsEX_depth_int\n\\__listsEX:VnnV \\l__listsEX_instance_tl {#3} {#1} \\BODY\n\\endlist\n\\dim_compare:nNnF { \\l__listsEX_after_list_skip } = { 0pt }\n{ \\vspace {\\l__listsEX_after_list_skip} }\n}\n\n% --------------------------------------------------------------------------\n% command to start a new row:\n\\cs_new_protected:Npn \\listsEX_new_row:\n{\n\\int_gset:Nn \\g__listsEX_total_items_int\n{\n\\g__listsEX_total_items_int +\n\\l__listsEX_columns_int -\n\\g__listsEX_current_col_num_int\n}\n\\__listsEX_gset_rows_num:NN\n\\g__listsEX_total_items_int\n\\l__listsEX_columns_int\n\\int_gset_eq:NN \\g__listsEX_current_col_num_int \\l__listsEX_columns_int\n}\n\n\\NewDocumentCommand \\startnewitemlineEX {}\n{ \\listsEX_new_row: }\n\n% --------------------------------------------------------------------------\n% the user environment:\n\\NewDocumentCommand \\NewListsEX { O{}mO{\\listEX}D(){1} }\n{\n\\NewDocumentEnvironment {#2} { O{}D(){#4} }\n{ \\__listsEX_env: {#3} { #1,##1 } {##2} }\n{ \\end__listsEX_env: }\n}\n\n\\NewDocumentCommand \\RenewListsEX { O{}mO{\\listEX}D(){1} }\n{\n\\RenewDocumentEnvironment {#2} { O{}D(){#4} }\n{ \\__listsEX_env: {#3} { #1,##1 } {##2} }\n{ \\end__listsEX_env: }\n}\n\n% --------------------------------------------------------------------------\n% default list:\n\\NewListsEX {listsEX}\n\n\\file_if_exist:nT {listsEX.cfg} { \\file_input:n {listsEX.cfg} }\n\n% --------------------------------------------------------------------------\n% setup:\n\\cs_new_protected:Npn \\listsEX_setup:n #1\n{ \\keys_set:nn {listsEX/list} {#1} }\n\n\\NewDocumentCommand \\setlistsEX { m }\n{ \\listsEX_setup:n {#1} }\n\\newcommand{\\StartNumber}[1]{\n\\int_gset:Nn \\g__listsEX_int {#1}\n}\n%tasks\n\\NewListsEX{taskEX}[\\item]\n\\NewEnviron{listEX}[1][]{%\n\\hfill\n\\ifstrempty{#1}{%\n\\begin{enumerate}\n\\BODY\n\\end{enumerate}\n}{%\n\\def\\tempbegin{\\begin{taskEX}(#1)}%\n\\expandafter\\tempbegin\\BODY\n\\end{taskEX}\n}\n}\n\\NewEnviron{enumEX}[2][]{%\n\\hfill\n\\ifthenelse{\\equal{#2}{1}}\n{\n\\ifstrempty{#1}\n{\n\\begin{enumerate}\n\\BODY\n\\end{enumerate}\n}\n{\n\\begin{enumerate}[#1]\n\\BODY\n\\end{enumerate}}\n}\n{\n\\ifstrempty{#1}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a])](#2)}%\n}{%\n\\ifthenelse{\\equal{#1}{a.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(a)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[a]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{a)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{A.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[A].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(A)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[A]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{A)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[A])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{1.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[1].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(1)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[1]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{1)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[1])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{i.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[r].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(i)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[r]),label-width=1.4em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{i)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[r])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{I.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[R].,label-width=1.4em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(I)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[R]),label-width=1.6em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{I)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[R]),label-width=1.4em](#2)}%\n}{\n\\def\\tempbegin{\\begin{taskEX}[label=#1](#2)}%\n}}}}}}}}}}}}}}}\n}\n\\expandafter\\tempbegin\\BODY\n\\end{taskEX}\n}\n}\n\\def\\loigiaiEX{\\colorbox{yellow!30!white}{Lời\\, giải.}}\n%End of file ‘ex_test.sty'.\n\n\n\n\n\\newif\\ifshowanswer\n\\showanswerfalse\n\\let \\hideanswer\\showanswerfalse\n\\let \\showanswer\\showanswertrue\n\\renewcommand{\\TrueEX}{\\ifshowanswer\\stepcounter{dapan}{{\\color{red}\\cbox{\\textbf{\\small\\Alph{dapan}}}} \\ignorespaces}\\else\\stepcounter{dapan}{{\\color{blue}\\cbox{\\textbf{\\small\\Alph{dapan}}}} \\ignorespaces}\\fi}\n\\newif \\ifhiendapan\\hiendapanfalse\n\\renewcommand{\\colorEX}{\\ifhiendapan\\color{red}\\else\\color{black}\\fi}"
                with codecs.open('Tool_ID/\\ex_test.sty', 'w', 'utf8') as (g):
                    g.write(ex_test)
                Print = 'Code Tikz được lưu trong Tool_ID\\[' + ID + ']-Tikz.tex'
                t = time.time() - start_time
                hour, minute, second = Time_convert(t)
                reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(k) + ' hình Tikz thỏa mãn ID đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print + '\nBạn có muốn mở file không?', QMessageBox.Yes, QMessageBox.No)
                if reply == QMessageBox.Yes:
                    path='Tool_ID\\[' + ID + ']-Tikz.tex'
                    if openfile(path)=='Error':
                        QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
                    path='Tool_ID\\[' + ID + ']-Tikz-main.tex'
                    if openfile(path)=='Error':
                        QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
                else:
                    Print = ''
                    t = time.time() - start_time
                    hour, minute, second = Time_convert(t)
                    reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(i) + ' câu thỏa mãn ID đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print, QMessageBox.Yes)
        except Exception as er:
            TB_Error_TQ(self, str(er))

    def G4_get_file_1(self):
        fname = QFileDialog.getOpenFileNames()
        filename = ''
        for i in fname[0]:
            filename += i + ','

        self.group4.line1.setText(filename[:-1])

    def G4_get_file_2(self):
        try:
            state = False
            start_time = time.time()
            List = List_creat(self.group4.line1.text())
            ID = self.group4.line2.text()
            Key1 = self.group4.line3.text()
            Key2 = self.group4.line4.text()
            operation = self.group4.combo.currentText()
            block_ID = ''
            i = 0
            try:
                if ID[3] == 'X':
                    for ID in [ID.replace('X', 'Y'), ID.replace('X', 'B'), ID.replace('X', 'K'), ID.replace('X', 'G'), ID.replace('X', 'T')]:
                        for filename in List:
                            block, j = get_block_ID_exbt(filename, ID, state)
                            if j != 0:
                                block_ID += '\r\n' + block
                            i += j

            except Exception as er:
                for filename in List:
                    block, j = get_block_ID_exbt(filename, ID, state)
                    block_ID += '\r\n' + block
                    i += j

            if 1 == 1:
                k = 0
                with codecs.open('Tool_ID/[' + ID + '].tex', 'w', 'utf-8') as (f):
                    f.write(block_ID)
                List = Random_GetListEX_FromFile('Tool_ID/[' + ID + '].tex')
                Test = ''
                for cau in List:
                    if operation == 'and':
                        if Key1 in cau:
                            if Key2 in cau:
                                Test += cau + '\n\n'
                                k += 1
                    if operation == 'or':
                        if Key1 in cau or Key2 in cau:
                            Test += cau + '\n\n'
                            k += 1

            if k != 0:
                with codecs.open('Tool_ID/Key-[' + ID + '].tex', 'w', 'utf-8') as (f):
                    f.write('%Keyword: ' + Key1 + ' ' + operation + ' ' + Key2 + '\n')
                    f.write('\\Opensolutionfile{ans}[ans/ans-Key-' + ID + ']')
                    f.write('\n\n' + Test)
                    f.write('\\Closesolutionfile{ans}')
                main = '\\documentclass[12pt,a4paper]{article}\n%\\usepackage{fourier}\n\\usepackage[utf8]{vietnam}\n\\usepackage{amsmath,amssymb,yhmath,mathrsfs,fancyhdr,tkz-euclide,tikz-3dplot}\n\\usepackage{framed,tikz,tkz-tab,tkz-linknodes,pgfplots,currfile,enumerate}\n\\usetikzlibrary{shapes.geometric,arrows,calc,intersections,angles,patterns,snakes,shadings,quotes}\n\\usetkzobj{all}\n\\usepgfplotslibrary{fillbetween}\n\\pgfplotsset{compat=1.9}\n\\usepackage[top=1.5cm, bottom=1.5cm, left=1.5cm, right=1.5cm] {geometry}\n\\usepackage[hidelinks,unicode,pdfencoding=unicode, psdextra]{hyperref}\n\\usepackage[loigiai]{ex_test}\n\\renewcommand{\\vec}[1]{\\protect\\overrightarrow{#1}}\n\\newcommand{\\hoac}[1]{\\left[\\begin{aligned}#1\\end{aligned}\\right.}\n\\newcommand{\\heva}[1]{\\left\\{\\begin{aligned}#1\\end{aligned}\\right.}\n\\renewcommand{\\labelenumi}{\\alph{enumi})}\n\\usepackage{multirow}\n\\usepackage{makecell}\n\\usepackage{lastpage}\n\\renewcommand{\\baselinestretch}{1.2}\n% Format nhóm LaTeX\n\\usepackage{fancyhdr}\n\\pagestyle{fancy}\n\\lhead{\\color{blue!50!black} \\sc Dự án (2019)}\n\\rhead{\\color{blue!50!black}\\sc Nhóm \\LaTeX}\n\\lfoot{\\color{blue!50!black}\\href{https://www.facebook.com/groups/NganHangOffline/}{/groups/NganHangOffline/}}\n\\cfoot{}\n\\renewcommand{\\headrulewidth}{0.1pt}\n\\renewcommand{\\footrulewidth}{0.1pt}\n% Định nghĩa làm tiêu đề của gói dethi\n\\usepackage{refcount}\n\\newcommand{\\pagediff}[1]{%\n\t\\number\\numexpr\\getpagerefnumber{#1}-\\thepage+1\\relax}\n\\newcommand{\\@ttruong}{Sở GD\\&ĐT TP. Hồ Chí Minh}\n\\newcommand{\\@tkhoa}{THPT Trần Hưng Đạo}\n\\newcommand{\\@ldethi}{(Đề thi có \\@scau\\, câu/\\@strang\\, trang.)}\n\\newcommand{\\@tkythi}{Đề thi thử THPT Quốc Gia năm 2019}\n\\newcommand{\\@tmonhoc}{Môn Toán: 12.}\n\\newcommand{\\@tgian}{45}\n\\newcommand{\\@scau}{50}\n\\newcommand{\\@strang}{4}\n\\newcommand{\\@madethi}{Mã đề thi: 108}\n\\newcommand{\\@hovaten}{\\dotfill}\n\\newcommand{\\@sobaodanh}{\\dotfill}\n\\newcommand{\\tentruong}[1]{\\renewcommand{\\@ttruong}[1]{#1}}\n\\newcommand{\\tenkhoa}[1]{\\renewcommand{\\@tkhoa}{#1}}\n\\newcommand{\\loaidethi}[1]{\\renewcommand{\\@ldethi}{#1}}\n\\newcommand{\\tenkythi}[1]{\\renewcommand{\\@tkythi}{#1}}\n\\newcommand{\\tenmonhoc}[1]{\\renewcommand{\\@tmonhoc}{#1}}\n\\newcommand{\\thoigian}[1]{\\renewcommand{\\@tgian}{#1}}\n\\newcommand{\\socauhoi}[1]{\\renewcommand{\\@scau}{#1}}\n\\newcommand{\\sotrang}[1]{\\renewcommand{\\@strang}{#1}}\n\\newcommand{\\madethi}[1]{\\renewcommand{\\@madethi}{Mã đề thi: #1}}\n\\newcommand{\\hovaten}[1]{\\renewcommand{\\@hovaten}{\\color{red}#1}}\n\\newcommand{\\sobaodanh}[1]{\\renewcommand{\\@sobaodanh}{{\\color{red}#1}}}\n\\newcommand{\\lamtieude}{\n\\begin{minipage}[b]{0.35\\textwidth}\n\\centering\\textbf{\\@ttruong}\\\\\\textbf{\\@tkhoa}\\\\\\@ldethi\n\\end{minipage}\n\\hfill\n\\begin{minipage}[b]{0.65\\textwidth}\n\\centering\\textbf{\\@tkythi}\\\\\\textbf{\\@tmonhoc}\\\\\\underline{\\it Thời gian làm bài \\@tgian\\ phút.}\\\\\n\\end{minipage}\\vspace{3pt}\n\\begin{minipage}[b]{0.6\\textwidth}\n\\bf Họ và tên: \\@hovaten\n\\end{minipage}\n\\begin{minipage}[b]{0.4\\textwidth}\n\\bf SBD: \\@sobaodanh\\hfill\\fbox{\\@madethi}\n\\end{minipage}\n\\bigskip\n}\n\\rfoot{\\color{blue!50!black} Trang \\thepage/\\pageref{LastPage}\\, -- \\@madethi }% Ẩn hiện làm đáp án\n\\newcommand{\\hienda}{1}% 1: hiện đáp án, 0: không hiện đáp án\n\\ifthenelse{\\hienda=1}{\\newcommand{\\lamdapan}[1]{\n\\newpage\n\\begin{center}\n\\textbf{ĐÁP ÁN}\n\\end{center}\n\\begin{multicols}{10}\n\\input{#1}\n\\end{multicols}}}{\\newcommand{\\lamdapan}[1]{}}\n% Logo\n%\\usepackage[pages=all,placement=center]{background}\n%\\backgroundsetup{position={16cm,1.3cm},scale=1,color=black,opacity=0.2,angle=0,contents={\\centering{\\includegraphics[scale = 0.7]{LOGO}}}}\n\\renewtheorem{ex}{\\color{violet}Câu}\n\\newtheorem{bt}{\\color{violet}Bài}\n\\begin{document}\n\\input{Key-[' + ID + ']}\n\\end{document}\n'
                with codecs.open('Tool_ID/Key-[' + ID + ']-main.tex', 'w', 'utf-8') as (f):
                    f.write(main)
                ex_test = "\\ProvidesPackage{ex_test}[2018/07/29 for Ex_test version 2.4.3, Tran Anh Tuan]\n\\RequirePackage{ifthen}\n\\RequirePackage{fancyhdr}\n\\RequirePackage{multicol}\n\\RequirePackage{answers}\n\\RequirePackage{array}\n\\RequirePackage{multirow}\n\\RequirePackage{longtable}\n\\RequirePackage[utf8]{vietnam}\n\\RequirePackage{tikz}\n\\RequirePackage{ntheorem}\n\\RequirePackage{calc}\n\\RequirePackage{etoolbox}\n\\RequirePackage{probsoln}\n\\RequirePackage{picinpar}\n\\RequirePackage{filecontents}\n\\RequirePackage {expl3,xparse,epic,cntformats,xtemplate,environ}\n\n%Ẩn hiện công thức tự động\n\\newlength\\wsh\n\\newlength\\hsh\n\\newlength\\dsh\n\\newcommand{\\sh}[1]{%\n\\settowidth\\wsh{#1}%\n\\settoheight\\hsh{#1}%\n\\settodepth\\dsh{#1}%\n\\raisebox{0pt}[\\hsh][\\dsh]{\n\\rule{\\wsh}{0.1pt}}}\n\\newcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\newcommand{\\boxEX}[2][9pt]{%\n\\def\\sizeboxEX{#1}%\n\\setbox1=\\hbox{#2}%\n\\ \\EXbox{#2}\\ %\n}\n%Lệnh tagEX gán nhãn công thức thủ công\n\\newcommand{\\tagEX}[1]{%\n\\hfill{\\rm (#1)}%\n\\par\n\\@ifnextchar\\begin%\n{\\vspace{-\\baselineskip}}\n{}\n}\n%Đánh dấu phương án đúng\n\\newcommand{\\dapan}{Lệnh này giờ vô dụng}\n\\newcommand*\\circled[1]{\\tikz[baseline=(char.base)]{\n\\node[shape=circle,draw,inner sep=0.8pt] (char) {#1};}}\n\\newcommand*\\circEX[1]{\\tikz[baseline=(char.base)]{\\node[shape=circle,draw=red,inner sep=1pt] (char) {\\bf\\color{red} #1};}}\n\\newcommand*\\squareEX[1]{\\tikz[baseline=(char.base)]{\\node[shape=rectangle,draw=red,inner sep=2.5pt,fill=yellow!50] (char) {\\color{red} #1};}}\n\\newcounter{dapan}\n\\newcommand{\\TrueEX}{\\stepcounter{dapan}{{\\color{blue}\\circled{\\textbf{\\Alph{dapan}}}} \\ignorespaces}}\n\\newcommand{\\FalseEX}{\\stepcounter{dapan}{\\color{blue}\\circled{\\textbf{\\Alph{dapan}}} \\ignorespaces}}\n\\newlength\\widthalpha\n\\newlength\\widthalphaT\n\\newlength\\widthalphaF\n\\settowidth\\widthalphaT{\\TrueEX}\n\\settowidth\\widthalphaF{\\FalseEX}\n\\ifdim\\widthalpha<\\widthalphaT\\relax\\setlength{\\widthalpha}{\\widthalphaT}\\fi%\n\\ifdim\\widthalpha<\\widthalphaF\\relax\\setlength{\\widthalpha}{\\widthalphaF}\\fi%\n\\newcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\newcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n%Hiện Chọn đáp án trong lời giải chi tiết\n\\def\\selectA{\\par\\noindent Chọn đáp án \\circEX{A}}\n\\def\\selectB{\\par\\noindent Chọn đáp án \\circEX{B}}\n\\def\\selectC{\\par\\noindent Chọn đáp án \\circEX{C}}\n\\def\\selectD{\\par\\noindent Chọn đáp án \\circEX{D}}\n\\def\\selectE{\\par\\noindent Chọn đáp án \\circEX{E}}\n\\newcommand{\\hidetextchoice}{\n\\def\\selectA{}\n\\def\\selectB{}\n\\def\\selectC{}\n\\def\\selectD{}\n\\def\\selectE{}\n}\n\\newcommand{\\showtextchoice}{\n\\def\\selectA{\\par\\noindent Chọn đáp án \\circEX{A}}\n\\def\\selectB{\\par\\noindent Chọn đáp án \\circEX{B}}\n\\def\\selectC{\\par\\noindent Chọn đáp án \\circEX{C}}\n\\def\\selectD{\\par\\noindent Chọn đáp án \\circEX{D}}\n\\def\\selectE{\\par\\noindent Chọn đáp án \\circEX{E}}\n}\n%Tương thích môi trường enumerate,itemize\n\\def\\hfillEX{}\n\\BeforeBeginEnvironment{enumerate}\n{\\hfillEX}\n\\BeforeBeginEnvironment{itemize}\n{\\hfillEX}\n\\AtBeginEnvironment{multicols}\n{\\def\\hfillEX{}}\n\\newcommand{\\listenumerate}[1]{\n\\foreach \\xenumerate in {#1} {%môi trường\n\\AtBeginEnvironment{\\xenumerate}{\n\\def\\hfillEX{\\hfill}\n}\n\\AtEndEnvironment{\\xenumerate}{\n\\def\\hfillEX{}\n}\n}}\n\\listenumerate{ex}\n%Lời giải\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\dotlineans}[2]{\n\\AtBeginEnvironment{#2}{\n\\def\\colorEX{}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\makeatletter\n\\renewcommand{\\loigiai}[1]{\n\\dotlineEX{#1}\n}}}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\showansEX}[1]{\n\\AtBeginEnvironment{#1}{\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n##1%\n{}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\selectA\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\selectB\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\selectC\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\selectD\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\selectE \n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n##1\n\\end{onlysolution}\n}\n}}\n%Danh sách môi trường hiện dòng kẻ trong lời giải\n\\newcommand{\\hideansEX}[1]{\n\\AtBeginEnvironment{#1}{\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\colorEX{}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\renewenvironment{onlysolution}{%\n\\long@collect@body\\do@onlysolution\n}{}\n\\renewcommand{\\loigiai}[1]{\n}\n}}\n%Định nghĩa QED kết thúc chứng minh\n\\def\\qedEX{\\ensuremath{\\square}}\n%Đáp số câu hỏi tự luận\n\\Newassociation{solshort}{Solshort}{ansshort}\n\\renewcommand{\\Solshortlabel}[1]{\\color{violet}\\textbf{#1.}\n}\n\\newcommand{\\shortsolnum}[1]\n{\n\\renewenvironment{Solshort}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\color{violet}\\textbf{##1.}\n\\color{black}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\shortsol}[1]{\n\\scantokens{\n\\begin{solshort}\n#1\n\\end{solshort}}\n}\n%Trích dẫn nguồn\n\\def\\labelex{}\n\n\\newcommand{\\nameex}{Câu}\n%Dấu chấm, phảy sau mỗi phương án\n\\def\\dotEX{.}\n%Tương thích gói picinpar\n\\def\\picinpar{\\setlength{\\linewidth}{\\linewidth}}\n\\AtBeginEnvironment{window}{\\def\\picinpar{\\setlength{\\linewidth}{\\linewidth-\\picwd-\\lwindowsep-2\\fboxsep}}}\n%Tùy chọn lời giải\n\\newcommand{\\choicew}[1]{\\setlength{\\widthch}{#1}}\n\\newcommand{\\loigiai}[1]{\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n\\def\\colorEX{\\color{red}}\n\\newcounter{numTrue}\n\\newcounter{numTrueSol}\n\\DeclareOption{solcolor}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\setbox1=\\hbox{#2}%\n\\def\\sizeboxEX{#1}%\n\\ \\EXbox{#2}\\ %\n}\n\\renewcommand{\\sh}[1]{#1}\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\squareEX{\\textbf{\\Alph{dapan}}}}}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\circled{\\textbf{\\Alph{dapan}}}}}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\leavevmode\\colorEX\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n#1%\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\leavevmode\\unskip\\selectA\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\leavevmode\\unskip\\selectB\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\leavevmode\\unskip\\selectC\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\leavevmode\\unskip\\selectD\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\leavevmode\\unskip\\selectE\\ignorespaces\n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n{}\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n}\n\\DeclareOption{loigiai}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{\\textbf{\\colorEX#1}}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\setbox1=\\hbox{#2}%\n\\def\\sizeboxEX{#1}%\n\\ \\EXbox{#2}\\ %\n}\n\\renewcommand{\\sh}[1]{#1}\n%%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\color{blue}{\\bf \\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n%Xuất hiện chữ Lời giải trong môi trường onlysolution\n\\renewcommand{\\do@onlysolution}[1]{%\n\\par\\vspace{-0.1cm}\\noindent\\dotfill\\vspace{-0.1cm}\n\\par\\noindent\\textbf{\\loigiaiEX }\n\\ifshowanswers\n\\@ifnextchar\\immini\n{}\n{ \\@ifnextchar\\begin\n{}\n{\\par\\noindent}\n}\n#1%\n\\fi\n\\ifnum\\the\\value{numTrueSol}=1\n\\leavevmode\\unskip\\selectA\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\leavevmode\\unskip\\selectB\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\leavevmode\\unskip\\selectC\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\leavevmode\\unskip\\selectD\\ignorespaces\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\leavevmode\\unskip\\selectE\\ignorespaces\n\\fi\n\\setcounter{numTrueSol}{0}\n\\hfill\\qedEX\\noindent\\hrule\n{}\n}\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\begin{onlysolution}\n#1\n\\end{onlysolution}\n}\n}\n\\DeclareOption{color}{\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\squareEX{\\textbf{\\Alph{dapan}}}}}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\circled{\\textbf{\\Alph{dapan}}}}}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\TrueEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\colorEX{\\color{red}}\n\\def\\True{\\leavevmode\\colorEX\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}}\n}\n\\DeclareOption{book}{\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n%\\renewcommand{\\TrueEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\loigiaiEX{\\color{blue} Lời giải.}\n\\showanswers\n\\makeatletter\n\\renewcommand{\\loigiai}[1]{\n\\labelex\n\\def\\labelex{}\n\\ifnum\\the\\value{numTrueSol}=1\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectA\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=2\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectB\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=3\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectC\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=4\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectD\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=5\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\par\\noindent\n\\selectE\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\ifnum\\the\\value{numTrueSol}=0\n\\scantokens{\n\\begin{solbook}\n\\par\\noindent\n#1\n\\hfill\\qedEX\n\\end{solbook}}\n\\fi\n\\setcounter{numTrueSol}{0}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}} \n}\n\\DeclareOption{dethi}{\n\\renewcommand{\\TF}[1]{\\EXboxTF{}}\n\\renewcommand{\\boxEX}[2][9pt]{%\n\\def\\sizeboxEX{#1}%\n\\setbox1=\\hbox{#2}%\n\\ \\EXbox{}\\ %\n}\n%\\renewcommand{\\FalseEX}{\\stepcounter{dapan}{\\textbf{\\Alph{dapan}}}.}\n\\makeatletter\n\\renewcommand{\\begindapan}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{\\dorong}\n}\n}\n\\renewcommand{\\begindapanhaiba}{\n\\@ifnextchar\\True\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n{\n\\begin{minipage}[h]{\\widthalpha}\n\\FalseEX\n\\end{minipage}\n\\begin{minipage}[t]{0.67\\dorong}\n}\n}\n\\def\\True{\\setcounter{numTrue}{\\thedapan}\\setcounter{numTrueSol}{\\thedapan}} \n}\n\\ExecuteOptions{dethi}\n\\ProcessOptions\n%Nội dung gói ex_test\n\\theorempreskipamount0.1\\baselineskip\n\\theorempostskipamount0.2\\baselineskip\n\\newlength\\dorongfix\n\\dorongfix=\\linewidth\n\\newlength\\dorong\n\\dorong=\\linewidth\n\\makeatletter\n\\newtheoremstyle{exbreak}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]}%\n{\\item\\hbox to \\linewidth{\\theorem@headerfont ##1\\ ##2\\\n(##3)\\theorem@separator\\hfill}}\n\\newtheoremstyle{explain}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]}%\n{\\item[\\hskip\\labelsep \\theorem@headerfont ##1\\ ##2\\theorem@separator]\\def\\labelex{\n\\begin{flushright}\n\\vspace*{-5pt}\n\\textit{\\textbf{(##3)}}\n\\vspace*{-5pt}\n\\end{flushright}}}\n%Danh sách môi trường trích dẫn nguồn câu hỏi\n\\newcommand{\\listtheorem}[1]{\n\\foreach \\x in {#1} {%môi trường\n\\AtEndEnvironment{\\x}{\n\\labelex\n}}}\n\\makeatother\n%\\theoremstyle{explain}\n\\theoremseparator{.}\n\\theorembodyfont{\\rm}\n\\Newassociation{solbook}{Solbook}{ansbook}\n\\renewcommand{\\Solbooklabel}[1]{\\textbf{\\nameex\\ #1.}\n}\n\\Newassociation{EXsol}{Solution}{ans}\n\\Newassociation{sol}{Solution}{ans_old}\n\\newtheorem{ex}{\\nameex}\n\\AtBeginEnvironment{Solbook}{\n\\renewcommand{\\IMleftright}[3]{\n\\par\\noindent\n\\begin{minipage}[t][][t]{\\linewidth-\\widthimmini-4\\fboxsep-#1\\linewidth}\n#2\n\\end{minipage}\n\\hspace{#1\\linewidth}\\hspace{2\\fboxsep}\n\\begin{minipage}[t][][b]{\\widthimmini}\\vspaceIM\n#3\n\\end{minipage}\n\\par\\nointerlineskip\n}\n}\n\\AtBeginEnvironment{ex}{\n\\setcounter{numTrueSol}{0}\n\\def\\dotEX{.}\n\\setcounter{numChoice}{0}\n}\n\\AtEndEnvironment{ex}{\n\\ifnum\\the\\value{numTrue}=1\n\\scantokens{\\begin{EXsol}A\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=2\n\\scantokens{\\begin{EXsol}B\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=3\n\\scantokens{\\begin{EXsol}C\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=4\n\\scantokens{\\begin{EXsol}D\\end{EXsol}}\n\\fi\n\\ifnum\\the\\value{numTrue}=5\n\\scantokens{\\begin{EXsol}E\\end{EXsol}}\n\\fi\n\\setcounter{numTrue}{0}\n\\setcounter{numTrueSol}{0}\n\\labelex\n}\n\\newtheorem{vdex}{Ví dụ}\n\\AtBeginEnvironment{vdex}{\\setcounter{numTrueSol}{0}\\def\\dotEX{.}}\n\\newcommand{\\boncot}[4]{\n\\picinpar\n\\setlength{\\dorong}{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\haicot}[4]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\motcot}[4]{\n\\picinpar\n\\setlength{\\dorong}{\\linewidth-0.02\\dorongfix-\\widthalpha-2\\fboxsep}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#2\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\\strut\n\\end{minipage}\n\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\\strut\n\\end{minipage}\n\n}\n%%%%%%%Tự động chọn \\motcot, \\haicot, \\boncot\n\\newlength\\widthcha\n\\newlength\\widthchb\n\\newlength\\widthchc\n\\newlength\\widthchd\n\\newlength\\widthche\n\\newlength\\widthch\n\\newlength\\tabmaxwidth\n\\newlength\\fourthtabwidth\n\\newlength\\halftabwidth\n\\newlength\\fifthtabwidth\n\\newlength\\thirdtabwidth\n\\newcommand{\\choice}[4]{%\n\\setlength\\tabmaxwidth{\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\halftabwidth{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\settowidth\\widthcha{#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\settowidth\\widthchb{#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\settowidth\\widthchc{#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\settowidth\\widthchd{#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\widthch<\\fourthtabwidth\n\\boncot{#1}{#2}{#3}{#4}\n\\else\\ifdim\\widthch<\\halftabwidth\n\\haicot{#1}{#2}{#3}{#4}\n\\else\n\\motcot{#1}{#2}{#3}{#4}\n\\fi\\fi\n}\n\\newcommand{\\choicefix}[4]{%\n\\setlength\\tabmaxwidth{\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\setlength\\halftabwidth{0.5\\linewidth-0.02\\dorongfix-\\widthalpha-3\\fboxsep}\n\\settowidth\\widthcha{#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\settowidth\\widthchb{#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\settowidth\\widthchc{#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\settowidth\\widthchd{#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\widthch<\\fourthtabwidth\n\\boncot{#1}{#2}{#3}{#4}\n\\else\\ifdim\\widthch<\\halftabwidth\n\\haicot{#1}{#2}{#3}{#4}\n\\else\n\\motcot{#1}{#2}{#3}{#4}\n\\fi\\fi\n}\n%Trắc nghiệm 5 lựa chọn\n\\newcommand{\\nammot}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.2\\linewidth-0.022\\dorongfix-2\\fboxsep-\\widthalpha}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#5\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\bahai}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\fboxsep-3\\widthalpha}\n\\setcounter{dapan}{0}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapanhaiba\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#2\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#3\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#5\\dotEX\n\\end{minipage}\n\n}\n\n\\newcommand{\\haiba}[5]{\n\\picinpar\n\\setlength{\\dorong}{0.5\\linewidth-0.02\\dorongfix-\\fboxsep-3\\widthalpha}\n\\setcounter{dapan}{0}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\n\\end{minipage}\n\\noindent\\begindapan\n#2\\dotEX\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapanhaiba\n#3\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#4\\dotEX\n\\end{minipage}\n\\noindent\\begindapanhaiba\n#5\\dotEX\n\\end{minipage}\n\n}\n\\newcommand{\\motnam}[5]{\n\\picinpar\n\\setlength{\\dorong}{\\linewidth-0.02\\dorongfix-\\fboxsep-2\\widthalpha}\n\\par\\setcounter{dapan}{0}\n\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#1\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#2\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#3\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#4\\dotEX\\strut\n\\end{minipage}\n\\par\\noindent\\hspace{0.02\\dorongfix}\\begindapan\n#5\\dotEX\\strut\n\\end{minipage}\n\n}\n\\newlength\\wmothai\n\\newlength\\wmothaiba\n\\newlength\\wmothaibabon\n\\newlength\\wbonnam\n\\newlength\\wbabonnam\n\\newlength\\whaibabonnam\n\\newcounter{numChoice}\n\\newcommand{\\choicefive}[5]{%\n\\setlength\\tabmaxwidth{\\linewidth-\\picwd-\\lwindowsep}\n\\setlength\\fourthtabwidth{0.25\\linewidth-0.25\\picwd-0.25\\lwindowsep-\\widthalpha}\n\\setlength\\halftabwidth{0.5\\linewidth-0.5\\picwd-0.5\\lwindowsep-\\widthalpha}\n\\setlength\\fifthtabwidth{0.2\\linewidth-0.2\\picwd-0.2\\lwindowsep-\\widthalpha}\n\\setlength\\thirdtabwidth{0.33\\linewidth-0.33\\picwd-0.33\\lwindowsep-\\widthalpha}\n\\settowidth\\widthcha{AM.#1}\n\\ifdim\\widthch<\\widthcha\\relax\\setlength{\\widthch}{\\widthcha}\\fi%\n\\ifdim\\wmothai<\\widthcha\\relax\\setlength{\\wmothai}{\\widthcha}\\fi%\n\\ifdim\\wmothaiba<\\widthcha\\relax\\setlength{\\wmothaiba}{\\widthcha}\\fi%\n\\ifdim\\wmothaibabon<\\widthcha\\relax\\setlength{\\wmothaibabon}{\\widthcha}\\fi%\n\\settowidth\\widthchb{BM.#2}%\n\\ifdim\\widthch<\\widthchb\\relax\\setlength{\\widthch}{\\widthchb}\\fi%\n\\ifdim\\wmothai<\\widthchb\\relax\\setlength{\\wmothai}{\\widthchb}\\fi%\n\\ifdim\\wmothaiba<\\widthchb\\relax\\setlength{\\wmothaiba}{\\widthchb}\\fi%\n\\ifdim\\wmothaibabon<\\widthchb\\relax\\setlength{\\wmothaibabon}{\\widthchb}\n\\fi%\n\\ifdim\\whaibabonnam<\\widthchb\\relax\\setlength{\\whaibabonnam}{\\widthchb}\n\\fi%\n\\settowidth\\widthchc{CM.#3}%\n\\ifdim\\widthch<\\widthchc\\relax\\setlength{\\widthch}{\\widthchc}\\fi%\n\\ifdim\\wmothaiba<\\widthchc\\relax\\setlength{\\wmothaiba}{\\widthchc}\\fi%\n\\ifdim\\wmothaibabon<\\widthchc\\relax\\setlength{\\wmothaibabon}{\\widthchc}\\fi%\n\\ifdim\\wbabonnam<\\widthchc\\relax\\setlength{\\wbabonnam}{\\widthchc}\\fi%\n\\ifdim\\whaibabonnam<\\widthchc\\relax\\setlength{\\whaibabonnam}{\\widthchc}\n\\fi%\n\\settowidth\\widthchd{DM.#4}%\n\\ifdim\\widthch<\\widthchd\\relax\\setlength{\\widthch}{\\widthchd}\\fi%\n\\ifdim\\wmothaibabon<\\widthchd\\relax\\setlength{\\wmothaibabon}{\\widthchd}\\fi%\n\\ifdim\\wbabonnam<\\widthchd\\relax\\setlength{\\wbabonnam}{\\widthchd}\\fi%\n\\ifdim\\wbonnam<\\widthchd\\relax\\setlength{\\wbonnam}{\\widthchd}\\fi%\n\\ifdim\\whaibabonnam<\\widthchd\\relax\\setlength{\\whaibabonnam}{\\widthchd}\n\\fi%\n\\settowidth\\widthche{EM.#5}%\n\\ifdim\\widthch<\\widthche\\relax\\setlength{\\widthch}{\\widthche}\\fi%\n\\ifdim\\wbabonnam<\\widthche\\relax\\setlength{\\wbabonnam}{\\widthche}\\fi%\n\\ifdim\\wbonnam<\\widthche\\relax\\setlength{\\wbonnam}{\\widthche}\\fi%\n\\ifdim\\whaibabonnam<\\widthchd\\relax\\setlength{\\whaibabonnam}{\\widthchd}\n\\fi%\n%Khởi tạo điều kiện \n\\setcounter{numChoice}{0}\n\\ifdim\\wmothai<\\halftabwidth\n\\ifdim\\wbabonnam<\\thirdtabwidth \n\\setcounter{numChoice}{1}\n\\fi\\fi\n\\ifdim\\wmothaiba<\\thirdtabwidth \n\\ifdim\\wbonnam<\\halftabwidth\n\\setcounter{numChoice}{2}\n\\fi\\fi\n\\ifdim\\widthch<\\fifthtabwidth\n\\setcounter{numChoice}{3}\n\\fi\n%Lựa chọn cách sắp xếp\n\\ifnum\\the\\value{numChoice}=3\n\\nammot{#1}{#2}{#3}{#4}{#5}\n\\else\n\\ifnum\\the\\value{numChoice}=2\n\\bahai{#1}{#2}{#3}{#4}{#5}\n\\else\n\\ifnum\\the\\value{numChoice}=1\n\\haiba{#1}{#2}{#3}{#4}{#5}\n\\else\n\\motnam{#1}{#2}{#3}{#4}{#5}\n\\fi\\fi\\fi\n}\n%HẾT trắc nghiệm 5 lựa chọn\n%Các phương pháp đưa hình vào văn bản\n\\def\\vspaceIM{\\vspace{-13pt}}\n\\def\\breakIM{}\n\\def\\numpicinpar{0}\n\\newdimen\\widthimmini\n\\newdimen\\heightimmini\n\\newdimen\\spaceleft\n\\newbox\\imbox\n\\newcommand{\\hspaceIM}[1]{\n\\def\\hspaceIMEX{\\hspace{#1\\linewidth}}\n\\def\\hspaceEXIM{#1\\linewidth}\n}\n\\newcommand{\\IMleftright}[3]{\n\\hfill\\par\\noindent\n\\begin{minipage}[t][][t]{\\linewidth-\\widthimmini-4\\fboxsep-#1\\linewidth}\n#2\n\\end{minipage}\n\\hspace{#1\\linewidth}\\hspace{2\\fboxsep}\n\\begin{minipage}[t][][b]{\\widthimmini}\\vspaceIM\n#3\n\\end{minipage}\n\\par\\nointerlineskip\n}\n\\newcommand{\\immini}[3][0]{\n\\setbox\\imbox=\\vbox{\\hbox{#3}}\n\\widthimmini=\\wd\\imbox\n\\heightimmini=\\ht\\imbox\n\\spaceleft=\\dimexpr\\textheight-\\pagetotal-2\\baselineskip\\relax\n\\ifdim\\heightimmini>\\spaceleft\n\\breakIM\n\\fi\n\\IMleftright{#1}{#2}{#3}\n}\n\\newcommand{\\impicinpar}[2]{\n\\begin{window}[\\numpicinpar,r,{\n#2\n}, {}]\n\\begin{flushleft}\n#1\n\\end{flushleft}\n\\end{window}\n}\n%Hết cách đưa hình vào văn bản\n\n% Biểu diễn khoảng, đoạn trên trục số\n\\usetikzlibrary{decorations.pathreplacing,decorations.markings,patterns}\n\\def\\colorInterval{black}\n\\def\\skipInterval{0.4cm}\n\\newcommand{\\Interval}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw[color=\\colorInterval] decorate[decoration={ticks,amplitude=3pt,segment length=1mm}] {(a)--(b)};\n}\n\\newcommand{\\IntervalR}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,-3pt) -- (3pt,3pt);\n}}] {(a)--(b)};\n}\n\\newcommand{\\IntervalL}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\draw decorate[decoration={\nmarkings,\nmark=between positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,3pt) -- (3pt,-3pt);\n}\n}\n] {(a)--(b)};\n}\n\\newcommand{\\IntervalLF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\fill[pattern=north west lines,pattern color=\\colorInterval](#2,-3pt)rectangle(#4,3pt);\n}\n\\newcommand{\\IntervalRF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (#2,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (#4,0); \n\\fill[pattern=north east lines,pattern color=\\colorInterval](#2,-3pt)rectangle(#4,3pt);\n}\n\\def\\pre{0}\n\\def\\next{2}\n\\newcommand{\\IntervalLR}[2]{\n\\def\\pre{#1}\n\\def\\next{#2}\n}\n\\newcommand{\\IntervalG}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw[color=\\colorInterval] decorate[decoration={ticks,amplitude=3pt,segment length=1mm}] {(a)--(b)};\n}\n\\newcommand{\\IntervalGL}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,3pt) -- (3pt,-3pt);\n}}] {(a)--(b)};\n}\n\\newcommand{\\IntervalGR}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\draw decorate[decoration={markings,mark=% actually add a mark\nbetween positions 0 and 1 step 1mm\nwith\n{\n\\draw[color=\\colorInterval] (-3pt,-3pt) -- (3pt,3pt);\n}}] {(a)--(b)};\n}\n\n\\newcommand{\\IntervalGLF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\fill[pattern=north west lines,pattern color=\\colorInterval](\\pre,-3pt)rectangle(\\next,3pt);\n}\n\\newcommand{\\IntervalGRF}[4]{%\n\\coordinate [label={center:$#1$},label=below:$\\rule{0pt}{\\skipInterval}#2$] (a) at (\\pre,0); \n\\coordinate [label={center:$#3$},label=below:$\\rule{0pt}{\\skipInterval}#4$] (b) at (\\next,0); \n\\fill[pattern=north east lines,pattern color=\\colorInterval](\\pre,-3pt)rectangle(\\next,3pt);\n}\n%Định nghĩa dots fill\n\\newcommand{\\dotlineEX}[1]{\n\\def\\numlinedot{#1}\n\\par\n\\foreach \\dotline in{1,...,\\numlinedot}\n{\n\\noindent\\dotfill\n\\par\n}\n}\n%Liệt kê danh sách đáp án\n\\newsavebox{\\myboxans}\n\\newcommand{\\boxans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{lrbox}{\\myboxans}\\begin{minipage}{0.1\\linewidth-4\\fboxsep}\n\\parbox[b]{0.55\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}\\end{lrbox}\\fbox{\\usebox{\\myboxans}}}\n}\n\\newcommand{\\listans}\n{\n\\renewenvironment{Solution}[1]\n{{\\color{blue}##1}\\hspace*{-4pt}}\n{\\hspace*{-5pt}}\n}\n\\newcommand{\\tabans}[1]\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.1\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n\\newcommand{\\inputans}[2]{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{\\linewidth/#1-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\n\\raggedleft\\color{blue}##1.\n}\n\\color{violet}\n}\n{\\end{minipage}}\n\\begin{flushleft}\n\\input{#2} \n\\end{flushleft}\n}\n\\newcommand{\\inputansbox}[2]{\n\\renewenvironment{Solution}[1]\n{\\begin{lrbox}{\\myboxans}\\begin{minipage}{\\linewidth/#1-4\\fboxsep}\n\\parbox[b]{0.55\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}\\end{lrbox}\\fbox{\\usebox{\\myboxans}}}\n\\begin{flushleft}\n\\input{#2} \n\\end{flushleft}\n}\n\\makeatletter\n\\@ifclasswith{article}{a5paper}\n{%\n\\renewcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.2\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n}{%\n}\n\\@ifclasswith{book}{a5paper}\n{%\n\\renewcommand{\\rowans}\n{\n\\renewenvironment{Solution}[1]\n{\\begin{minipage}{0.2\\linewidth-1.2\\fboxsep}\n\\parbox[b]{0.45\\linewidth}{\\color{blue}##1.}\n\\color{violet}\n}\n{\\end{minipage}}\n}\n}{%\n}\n\\makeatother\n%Hỗ trợ gói ex_test_rd\n\\newenvironment{fileEX}{\\filecontents}{\\endfilecontents}\n\\newcommand{\\bankEX}[2]{\n\\input{#1}\n}\n\\newtheorem{exrd}{Câu}\n\\def\\listfile{\n\\bankEX{onefile.tex}{50}\n}\n\\def\\testname{\n\\begin{center}\n\\textbf{ĐỀ THI MẪU}\n\\end{center}\n\\rightline{\n\\setlength\\fboxrule{2pt} \n\\setlength\\fboxsep{5pt} \n\\fbox{\\textbf{Mã đề thi\\ \\x}}\n}\n}\n\\newcommand{\\randombank}[1]{\n%\\testname\n\\begin{center}\n\\textbf{\n\\color{red}\nBạn đang chạy bằng gói ex\\_test xuất ra MỌI CÂU HỎI của ngân hàng nhằm soát lỗi.\\\\\nKhi mọi thứ đã OK, hãy thay khai báo gói ex\\_test bằng gói ex\\_test\\_rd\n}\n\\end{center}\n\\Opensolutionfile{ans}[ans/ans_ex_test]\n\\listfile\n\\Closesolutionfile{ans}\n}\n\\newcommand{\\showansfull}{\\par Các mã đề: }\n\\newcommand{\\showans}{\\par Các mã đề: }\n%Đường tròn LG\n\\usetikzlibrary{plotmarks}\n\\newcommand{\\trucLG}{\n\\draw[->] (0,-1.3) -- (0,1.3) node[left] {$\\sin$};\n\\draw[->] (-1.3,0) -- (1.3,0) node[below] {$\\cos$};\n\\draw (0,0) circle (1cm);\n}\n\\newcommand{\\pointLG}[4]\n{\n\\foreach \\i in {0,...,#2}\n{\n\\draw[color=#4]\nplot[mark=#3] coordinates {({#1+\\i*360/#2}:1)};\n}\n}\n\\makeatletter\n\\def\\sizeboxEX{9pt}\n\\def\\EXbox#1{%\n\\begingroup%\n\\setlength{\\fboxsep}{0.3ex}%\n\\setlength{\\@tempdima}{\\sizeboxEX}%\n\\setlength{\\@tempdimb}{(\\@tempdima-\\ht1+\\dp1)/2}%\n\\raise-\\@tempdimb\\hbox{\\fbox{\\vbox to \\@tempdima{%\n\\vfil\\hbox to \\@tempdima{\\hfil#1\\hfil}\\vfil}}}%\n\\endgroup%\n}\n\\def\\EXboxTF#1{%\n\\begingroup%\n\\setlength{\\fboxsep}{0.3ex}%\n\\setbox1=\\hbox{#1}%\n\\setlength{\\@tempdima}{\\sizeboxEX}%\n\\fbox{\\vbox to \\@tempdima{%\n\\vfil\\hbox to \\@tempdima{\\hfil\\copy1\\hfil}\\vfil}}%\n\\endgroup%\n}\n\\makeatother\n% Môi trường liệt kê dàn theo nhiều dòng khác nhau\n\\ExplSyntaxOn\n% variants of kernel functions:\n\\cs_generate_variant:Nn \\tl_if_eq:nnTF { V }\n\\cs_generate_variant:Nn \\tl_if_eq:nnT { V }\n\n% --------------------------------------------------------------------------\n% variables:\n\\seq_new:N \\l__listsEX_seq\n\n\\int_new:N \\l__listsEX_depth_int\n\\int_new:N \\g__listsEX_int\n\\int_new:N \\g__listsEX_total_items_int\n\\int_new:N \\l__listsEX_columns_int\n\\int_new:N \\l__listsEX_rows_int\n\\int_new:N \\g__listsEX_current_col_num_int\n\\int_new:N \\g__listsEX_current_row_num_int\n\\int_new:N \\l__listsEX_item_columns_int\n\n\\bool_new:N \\l__listsEX_enumerate_bool\n\\bool_new:N \\l__listsEX_resume_bool\n\\bool_new:N \\l__listsEX_load_listsEX_bool\n\\bool_new:N \\l__listsEX_label_width_bool\n\\bool_new:N \\l__listsEX_item_indent_bool\n\\bool_new:N \\l__listsEX_label_offset_bool\n\\bool_new:N \\l__listsEX_custom_label_bool\n\\bool_new:N \\l__listsEX_custom_after_item_skip_bool\n\\bool_new:N \\l__listsEX_debug_bool\n\\bool_new:N \\l__listsEX_item_full_line_bool\n\\bool_new:N \\l__listsEX_item_rest_of_line_bool\n\n\\tl_new:N \\l__listsEX_instance_tl\n\\tl_new:N \\l__listsEX_label_tl\n\\tl_new:N \\l__listsEX_custom_label_tl\n\\tl_new:N \\l__listsEX_label_pattern_tl\n\\tl_new:N \\l__listsEX_custom_label_pattern_tl\n\\tl_new:N \\l__listsEX_label_format_tl\n\\tl_new:N \\l__listsEX_custom_label_format_tl\n\\tl_new:N \\l__listsEX_item_format_tl\n\\tl_new:N \\l__listsEX_custom_item_format_tl\n\\tl_new:N \\l__listsEX_item_fill_left_tl\n\\tl_new:N \\l__listsEX_item_fill_right_tl\n\\tl_new:N \\l__listsEX_label_align_tl\n% \\tl_new:N \\listEX\n\\tl_new:N \\l__listsEX_item_tl\n\\tl_new:N \\l__listsEX_tmp_label_tl\n\n\\dim_new:N \\l__listsEX_item_indent_dim\n\\dim_new:N \\l__listsEX_item_default_indent_dim\n\\dim_new:N \\l__listsEX_item_width_dim\n\\dim_new:N \\l__listsEX_label_width_dim\n\\dim_new:N \\l__listsEX_label_default_width_dim\n\\dim_new:N \\l__listsEX_label_offset_dim\n\\dim_new:N \\l__listsEX_label_default_offset_dim\n\\dim_new:N \\l__listsEX_column_sep_dim\n\n\\skip_new:N \\l__listsEX_after_item_skip\n\\skip_new:N \\l__listsEX_custom_after_item_skip\n\\skip_new:N \\l__listsEX_before_list_skip\n\\skip_new:N \\l__listsEX_after_list_skip\n\n\\coffin_new:N \\l__listsEX_item_coffin\n\\coffin_new:N \\l__listsEX_label_coffin\n\n\\NewCounterPattern* [ listsEX ] { listEX } { tsk }\n\\ReadCounterFrom [ listsEX ] { listEX } \\g__listsEX_int\n\n% temporary variables:\n\\int_new:N \\l__listsEX_tmpa_int\n\\int_new:N \\l__listsEX_tmpb_int\n\\tl_new:N \\l__listsEX_tmpa_tl\n\\coffin_new:N \\l__listsEX_tmpa_coffin\n\n\\cs_new:Npn \\__listsEX_debug:n #1\n{\n\\bool_if:NTF \\l__listsEX_debug_bool\n{ \\fbox {#1} }\n{ \\use:n {#1} }\n}\n\n% --------------------------------------------------------------------------\n% collect the listsEX:\n\\cs_new_protected:Npn \\__listsEX_collect_listsEX:nww #1#2 \\end #3\n{\n\\tl_put_right:Nn \\l__listsEX_body_tl {#1}\n\\end {#3}\n\\tl_if_eq:nnF {#1} {#3}\n{ \\__listsEX_collect_listsEX:nww {#1} }\n}\n\n% #1: instance\n% #2: number of columns\n% #3: item separator\n% #4: environment body\n\\cs_new_protected:Npn \\__listsEX:nnnn #1#2#3#4\n{\n\\bool_if:NT \\l__listsEX_debug_bool { \\dim_set:Nn \\fboxsep {0pt} }\n\\seq_set_split:Nnn \\l__listsEX_seq {#3} {#4}\n% remove the first (empty) item:\n\\seq_pop_left:NN \\l__listsEX_seq \\l__listsEX_tmpa_tl\n\\tl_if_blank:VF \\l__listsEX_tmpa_tl { \\@noitemerr }\n\\int_gset:Nn \\g__listsEX_total_items_int\n{ \\seq_count:N \\l__listsEX_seq }\n\\UseInstance {listsEX} {#1}\n{ \\g__listsEX_total_items_int }\n{#2}\n{ \\l__listsEX_custom_label_pattern_tl }\n% just to be sure:\n\\seq_clear:N \\l__listsEX_seq\n}\n\\cs_generate_variant:Nn \\__listsEX:nnnn { VnnV }\n\n% #1: label\n% #2: item format\n% #3: item\n\\cs_new_protected:Npn \\__listsEX_listEX:nnn #1#2#3\n{\n% start a new item line if \\l__listsEX_item_full_line_bool\n\\bool_if:NT \\l__listsEX_item_full_line_bool\n{\n% add skip if we were in the middle of a line, i.e., in horizontal\n% mode:\n\\mode_if_horizontal:T\n{ \\skip_vertical:N \\l__listsEX_after_item_skip }\n\\listsEX_new_row:\n}\n% step column position:\n\\int_gincr:N \\g__listsEX_current_col_num_int\n\\dim_set:Nn \\l__listsEX_item_width_dim\n{\n\\bool_if:NTF \\l__listsEX_item_full_line_bool\n{ \\linewidth }\n{\n(\n\\linewidth\n-\\fboxsep \n- \\l__listsEX_columns_int \\l__listsEX_column_sep_dim\n+ \\l__listsEX_column_sep_dim\n) / \\l__listsEX_columns_int\n}\n- \\l__listsEX_depth_int \\l__listsEX_item_indent_dim\n\\bool_if:NT \\l__listsEX_debug_bool { -2\\fboxrule }\n}\n\\__listsEX_gset_rows_num:NN\n\\g__listsEX_total_items_int\n\\l__listsEX_columns_int\n% set \\g__listsEX_current_col_num_int to 1 if at the start of a row,\n% then also step \\g__listsEX_current_row_num_int :\n\\int_compare:nNnT\n{ \\g__listsEX_current_col_num_int } > { \\l__listsEX_columns_int }\n{\n\\int_gset:Nn \\g__listsEX_current_col_num_int { 1 }\n\\int_incr:N \\g__listsEX_current_row_num_int\n}\n\\bool_if:NT \\l__listsEX_item_rest_of_line_bool\n{\n\\int_set:Nn \\l__listsEX_tmpa_int\n{ \\l__listsEX_columns_int - \\g__listsEX_current_col_num_int + 1 }\n\\int_compare:nNnTF { \\l__listsEX_item_columns_int } = { 0 }\n{\n\\int_set:Nn \\l__listsEX_tmpb_int { \\l__listsEX_tmpa_int - 1 } % 8\n}\n{\n\\int_compare:nNnTF\n{ \\l__listsEX_tmpa_int } > { \\l__listsEX_item_columns_int }\n{ \\int_set_eq:NN \\l__listsEX_tmpa_int \\l__listsEX_item_columns_int }\n{ \\int_zero:N \\l__listsEX_item_columns_int }\n\\bool_if:nT\n{\n\\l__listsEX_item_rest_of_line_bool &&\n!\\int_compare_p:nNn { \\l__listsEX_item_columns_int} = { 0 }\n}\n{\n\\int_gadd:Nn \\g__listsEX_current_col_num_int\n{ \\l__listsEX_item_columns_int -1 }\n\\int_gadd:Nn \\g__listsEX_total_items_int\n{ \\l__listsEX_item_columns_int -1 }\n}\n\\int_set:Nn \\l__listsEX_tmpb_int { \\l__listsEX_tmpa_int -1 }\n}\n\\dim_set:Nn \\l__listsEX_item_width_dim\n{\n\\l__listsEX_tmpa_int \\l__listsEX_item_width_dim\n+ \\l__listsEX_tmpb_int \\l__listsEX_column_sep_dim\n+ \\l__listsEX_tmpb_int \\l__listsEX_item_indent_dim\n\\bool_if:NT \\l__listsEX_debug_bool\n{ + \\int_eval:n { \\l__listsEX_tmpb_int * 2 } \\fboxrule }\n}\n}\n% set the item box:\n\\hcoffin_set:Nn \\l__listsEX_item_coffin\n{\n\\vcoffin_set:Nnn \\l__listsEX_tmpa_coffin\n{ \\l__listsEX_item_width_dim }\n{ \\__listsEX_setup: #2 {#3} \\strut }\n\\__listsEX_debug:n\n{\n\\coffin_typeset:Nnnnn \\l__listsEX_tmpa_coffin\n{l} {T} {0pt} {0pt}\n}\n}\n% set the label box:\n\\hcoffin_set:Nn \\l__listsEX_label_coffin\n{\n\\vcoffin_set:Nnn \\l__listsEX_tmpa_coffin\n{\n\\l__listsEX_label_width_dim\n\\bool_if:NT \\l__listsEX_debug_bool {-2\\fboxrule }\n}\n{\n\\noindent\n\\tl_use:N \\l__listsEX_item_fill_left_tl\n\\strut #1\n\\tl_use:N \\l__listsEX_item_fill_right_tl\n}\n\\__listsEX_debug:n\n{\n\\coffin_typeset:Nnnnn \\l__listsEX_tmpa_coffin\n{l} {T} {0pt} {0pt}\n}\n}\n% attach the label box at the left of the item box, shifted by\n% \\l__listsEX_label_offset_dim :\n\\coffin_attach:NnnNnnnn\n\\l__listsEX_item_coffin {l} {T}\n\\l__listsEX_label_coffin {l} {T}\n{\n\\dim_compare:nNnTF\n{ \\l__listsEX_item_indent_dim }\n<\n{ \\l__listsEX_label_offset_dim + \\l__listsEX_label_width_dim }\n{0pt}\n{ - \\l__listsEX_label_width_dim - \\l__listsEX_label_offset_dim }\n} { 0pt }\n% when a new row starts enter vertical mode:\n\\int_compare:nNnT { \\g__listsEX_current_col_num_int } = { 1 }\n{ \\skip_vertical:N \\c_zero_skip }\n% skip horizontally by \\l__listsEX_item_indent_dim\n\\noindent\n\\skip_horizontal:N \\l__listsEX_item_indent_dim\n% typeset the item (with the attached label protruding to the left):\n\\coffin_typeset:Nnnnn \\l__listsEX_item_coffin\n{l}\n{T}\n{0pt}\n{0pt}\n\\bool_if:nT\n{\n\\l__listsEX_item_full_line_bool ||\n(\n\\l__listsEX_item_rest_of_line_bool &&\n\\int_compare_p:nNn { \\l__listsEX_item_columns_int } = { 0 }\n)\n}\n{ \\listsEX_new_row: }\n% are we between items in a row? The skip by \\l__listsEX_column_sep_dim :\n\\int_compare:nNnT\n{ \\g__listsEX_current_col_num_int } < { \\l__listsEX_columns_int }\n{ \\skip_horizontal:N \\l__listsEX_column_sep_dim }\n% if we ended a row and a new row is still to come skip vertically by\n% \\l__listsEX_after_item_skip :\n\\bool_if:nT\n{\n( \\int_compare_p:nNn { \\g__listsEX_current_col_num_int } = { \\l__listsEX_columns_int } )\n&&\n( \\int_compare_p:n { \\g__listsEX_current_row_num_int != \\l__listsEX_rows_int } )\n}\n{ \\skip_vertical:N \\l__listsEX_after_item_skip }\n% clean up:\n\\coffin_clear:N \\l__listsEX_item_coffin\n\\coffin_clear:N \\l__listsEX_label_coffin\n\\coffin_clear:N \\l__listsEX_tmpa_coffin\n\\bool_set_false:N \\l__listsEX_item_full_line_bool\n\\bool_set_false:N \\l__listsEX_item_rest_of_line_bool\n}\n\\cs_generate_variant:Nn \\__listsEX_listEX:nnn { VVV }\n\n\\cs_new_protected:Npn \\__listsEX_setup:\n{\n\\dim_set:Nn \\parskip { 0pt }\n\\skip_set:Nn \\parfillskip { 0pt plus 1fil }\n\\dim_set_eq:NN \\parskip \\parsep\n\\dim_set_eq:NN \\parindent \\listparindent\n\\noindent\n\\dim_compare:nNnT\n{ \\l__listsEX_item_indent_dim }\n<\n{ \\l__listsEX_label_offset_dim + \\l__listsEX_label_width_dim }\n{\n\\skip_horizontal:n\n{\n\\l__listsEX_label_offset_dim\n+ \\l__listsEX_label_width_dim\n- \\l__listsEX_item_indent_dim\n}\n}\n\\strut\n}\n\n\\cs_new_protected:Npn \\__listsEX_gset_rows_num:NN #1#2\n{\n\\int_gset:Nn \\l__listsEX_rows_int { \\int_div_truncate:nn {#1} {#2} }\n\\int_compare:nNnT { \\int_mod:nn {#1} {#2} } > { 0 }\n{ \\int_gincr:N \\l__listsEX_rows_int }\n}\n\n\\cs_new_protected:Npn \\__listsEX_label_align:n #1\n{\n\\str_case:nnF {#1}\n{\n{left}\n{\n\\tl_clear:N \\l__listsEX_item_fill_left_tl\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n{right}\n{\n\\tl_set_eq:NN \\l__listsEX_item_fill_left_tl \\hfill\n\\tl_clear:N \\l__listsEX_item_fill_right_tl\n}\n{center}\n{\n\\tl_set_eq:NN \\l__listsEX_item_fill_left_tl \\hfill\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n}\n{\n\\tl_clear:N \\l__listsEX_item_fill_left_tl\n\\tl_set_eq:NN \\l__listsEX_item_fill_right_tl \\hfill\n}\n}\n\\cs_generate_variant:Nn \\__listsEX_label_align:n { V }\n\\__listsEX_label_align:n {left}\n\n% --------------------------------------------------------------------------\n% the ‘listsEX' object:\n% #1: number of items\n% #2: number of columns\n% #3: label-format\n\\DeclareObjectType {listsEX} {3}\n% the ‘default' template interface:\n\\DeclareTemplateInterface {listsEX} {default} {3}\n{\nenumerate : boolean = true ,\nlabel : tokenlist ,\nindent : length = 2.5em ,\ncounter-format : tokenlist = tsk[a]) ,\nlabel-format : tokenlist ,\nlabel-width : length = 1em ,\nlabel-offset : length = .3333em ,\nitem-format : tokenlist ,\nafter-item-skip : skip = 1ex plus 1ex minus 1ex\n}\n\n% in the next three commands we want a really unlikely to occur marker; for\n% this we use $ with unusual catcode in ‘‘$listsEX$default$label$'':\n\\cs_set:Nx \\__listsEX_restore_dollar:\n{ \\char_set_catcode:nn {36} { \\char_value_catcode:n {36} } }\n\\char_set_catcode_alignment:N \\$\n\n% the ‘default' template code:\n\\DeclareTemplateCode {listsEX} {default} {3}\n{\nenumerate = \\l__listsEX_enumerate_bool ,\nlabel = \\l__listsEX_label_tl ,\nindent = \\l__listsEX_item_default_indent_dim ,\ncounter-format = \\l__listsEX_label_pattern_tl ,\nlabel-format = \\l__listsEX_label_format_tl ,\nlabel-width = \\l__listsEX_label_default_width_dim ,\nlabel-offset = \\l__listsEX_label_default_offset_dim ,\nitem-format = \\l__listsEX_item_format_tl ,\nafter-item-skip = \\l__listsEX_after_item_skip\n}\n{\n\\AssignTemplateKeys\n\\bool_if:NF \\l__listsEX_label_width_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_label_width_dim\n\\l__listsEX_label_default_width_dim\n}\n\\bool_if:NF \\l__listsEX_item_indent_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_item_indent_dim\n\\l__listsEX_item_default_indent_dim\n}\n\\bool_if:NF \\l__listsEX_label_offset_bool\n{\n\\dim_set_eq:NN\n\\l__listsEX_label_offset_dim\n\\l__listsEX_label_default_offset_dim\n}\n\\bool_if:NT \\l__listsEX_custom_after_item_skip_bool\n{\n\\skip_set_eq:NN\n\\l__listsEX_after_item_skip\n\\l__listsEX_custom_after_item_skip\n}\n\\bool_if:NT \\l__listsEX_custom_label_bool\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_tl\n\\l__listsEX_custom_label_tl\n\\bool_set_false:N \\l__listsEX_enumerate_bool\n}\n\\__listsEX_label_align:V \\l__listsEX_label_align_tl\n% need this for enumerate list:\n\\bool_if:nT { !\\l__listsEX_resume_bool && \\l__listsEX_enumerate_bool }\n{ \\int_gzero:N \\g__listsEX_int }\n\\int_set:Nn \\l__listsEX_columns_int {#2}\n% set all the items in their own coffins and join with the ground:\n\\int_gzero:N \\g__listsEX_current_col_num_int\n\\int_set:Nn \\g__listsEX_current_row_num_int {1}\n\\tl_if_blank:VF \\l__listsEX_custom_label_pattern_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_pattern_tl\n\\l__listsEX_custom_label_pattern_tl\n}\n\\tl_if_blank:VF \\l__listsEX_custom_label_format_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_label_format_tl\n\\l__listsEX_custom_label_format_tl\n}\n\\tl_if_blank:VF \\l__listsEX_custom_item_format_tl\n{\n\\tl_set_eq:NN\n\\l__listsEX_item_format_tl\n\\l__listsEX_custom_item_format_tl\n}\n\\seq_map_inline:Nn \\l__listsEX_seq\n{\n\\__listsEX_read_item:www ##1 \\q_stop\n\\bool_if:NTF \\l__listsEX_enumerate_bool\n{\n\\tl_if_eq:VnT \\l__listsEX_tmp_label_tl { $listsEX$default$label$ }\n{\n\\int_gincr:N \\g__listsEX_int\n\\SaveCounterPatternFrom [listsEX]\n\\l__listsEX_tmpa_tl\n\\l__listsEX_label_tl\n\\l__listsEX_label_pattern_tl\n}\n}\n{\n\\tl_if_blank:VT \\l__listsEX_label_tl\n{ \\tl_set_eq:NN \\l__listsEX_label_tl \\labelitemi }\n}\n\\tl_put_left:NV \\l__listsEX_label_tl \\l__listsEX_label_format_tl\n% \\tl_put_left:NV \\l__listsEX_item_tl \\l__listsEX_item_format_tl\n\\tl_if_eq:VnTF \\l__listsEX_tmp_label_tl { $listsEX$default$label$ }\n{\n\\__listsEX_listEX:VVV\n\\l__listsEX_label_tl\n\\l__listsEX_item_format_tl\n\\l__listsEX_item_tl\n}\n{\n\\__listsEX_listEX:VVV\n\\l__listsEX_tmp_label_tl\n\\l__listsEX_item_format_tl\n\\l__listsEX_item_tl\n\\tl_clear:N \\l__listsEX_tmp_label_tl\n}\n}\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item:www\n{\n\\peek_meaning_remove:NTF !\n{\n\\bool_set_true:N \\l__listsEX_item_full_line_bool\n\\__listsEX_read_item_aux:ww\n}\n{\n\\peek_meaning_remove:NTF *\n{\n\\bool_set_true:N \\l__listsEX_item_rest_of_line_bool\n\\__listsEX_read_item_rest_of_line:ww\n}\n{ \\__listsEX_read_item_aux:ww }\n}\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_rest_of_line:ww\n{\n\\peek_meaning:NTF ( % )\n{ \\__listsEX_read_item_rest_of_line_aux:ww }\n{ \\__listsEX_read_item_rest_of_line_aux:ww (0) }\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_rest_of_line_aux:ww (#1)\n{\n\\int_set:Nn \\l__listsEX_item_columns_int {#1}\n\\__listsEX_read_item_aux:ww\n}\n\n\\cs_new_protected:Npn \\__listsEX_read_item_aux:ww\n{\n\\peek_meaning:NTF [ % ]\n{ \\__listsEX_read_item_aux_ii:ww }\n{ \\__listsEX_read_item_aux_ii:ww [$listsEX$default$label$] }\n}\n\\cs_new_protected:Npn \\__listsEX_read_item_aux_ii:ww [#1]#2 \\q_stop\n{\n\\tl_set:Nn \\l__listsEX_tmp_label_tl {#1}\n\\tl_if_eq:nnF { #1 } { $listsEX$default$label$ }\n{ \\tl_put_left:NV \\l__listsEX_tmp_label_tl \\l__listsEX_label_format_tl }\n\\tl_set:Nx \\l__listsEX_item_tl { \\tl_trim_spaces:n {#2} }\n}\n\n\\__listsEX_restore_dollar:\n\n% --------------------------------------------------------------------------\n% choice box:\n\\bool_new:N \\l__listsEX_choice_checked_bool\n\\dim_new:N \\l__listsEX_choice_width_dim\n\\dim_set:Nn \\l__listsEX_choice_width_dim { 1.25ex }\n\\dim_new:N \\l__listsEX_choice_linewidth_dim\n\\dim_set:Nn \\l__listsEX_choice_linewidth_dim { .3pt }\n\\dim_new:N \\l__listsEX_choice_checkwidth_dim\n\\dim_set:Nn \\l__listsEX_choice_checkwidth_dim { .5pt }\n\\dim_new:N \\l__listsEX_choice_raise_dim\n\\dim_set:Nn \\l__listsEX_choice_raise_dim { .1ex }\n\n\\cs_new_protected:Npn \\listsEX_choice:\n{\n\\leavevmode\n\\group_begin:\n\\bool_set_false:N \\l__listsEX_choice_checked_bool\n\\box_move_up:nn\n{ \\l__listsEX_choice_raise_dim }\n{ \\hbox:n { \\__listsEX_choice: } }\n\\group_end:\n}\n\n\\cs_new_protected:Npn \\listsEX_choice_checked:\n{\n\\leavevmode\n\\group_begin:\n\\bool_set_true:N \\l__listsEX_choice_checked_bool\n\\box_move_up:nn\n{ \\l__listsEX_choice_raise_dim }\n{ \\hbox:n { \\__listsEX_choice: } }\n\\group_end:\n}\n\n\\cs_new_protected:Npn \\__listsEX_choice:\n{%\n\\dim_set:Nn \\unitlength { .1\\l__listsEX_choice_width_dim }\n\\begin{picture}(10,0)\n\\linethickness \\l__listsEX_choice_linewidth_dim\n\\drawline(0,0)(0,10)(10,10)(10,0)(0,0)\n\\linethickness \\l__listsEX_choice_checkwidth_dim\n\\bool_if:NT \\l__listsEX_choice_checked_bool\n{\n\\drawline(2,2)(8,8)\n\\drawline(2,8)(8,2)\n}\n\\end{picture}%\n}\n\n\\providecommand* \\choicebox { \\listsEX_choice: }\n\\providecommand* \\checkedchoicebox { \\listsEX_choice_checked: }\n\n% --------------------------------------------------------------------------\n% base instance:\n% ALPHABETIZE: a) b) c)\n\\DeclareInstance {listsEX} {alphabetize} {default} { }\n\n\\keys_define:nn {listsEX/list}\n{\ndebug .bool_set:N = \\l__listsEX_debug_bool ,\nstyle .tl_set:N = \\l__listsEX_instance_tl ,\nstyle .initial:n = alphabetize ,\ncounter-format .tl_set:N = \\l__listsEX_custom_label_pattern_tl ,\nlabel .code:n =\n\\bool_set_true:N \\l__listsEX_custom_label_bool\n\\tl_set:Nn \\l__listsEX_custom_label_tl {#1} ,\nlabel-format .tl_set:N = \\l__listsEX_custom_label_format_tl ,\nlabel-width .code:n =\n\\dim_set:Nn \\l__listsEX_label_width_dim {#1}\n\\bool_set_true:N \\l__listsEX_label_width_bool ,\nlabel-offset .code:n =\n\\dim_set:Nn \\l__listsEX_label_offset_dim {#1}\n\\bool_set_true:N \\l__listsEX_label_offset_bool ,\nlabel-align .tl_set:N = \\l__listsEX_label_align_tl ,\nitem-format .tl_set:N = \\l__listsEX_custom_item_format_tl ,\nitem-indent .code:n =\n\\dim_set:Nn \\l__listsEX_item_indent_dim {#1}\n\\bool_set_true:N \\l__listsEX_item_indent_bool ,\ncolumn-sep .dim_set:N = \\l__listsEX_column_sep_dim ,\nbefore-skip .skip_set:N = \\l__listsEX_before_list_skip ,\nafter-skip .skip_set:N = \\l__listsEX_after_list_skip ,\nafter-item-skip .code:n =\n\\bool_set_true:N \\l__listsEX_custom_after_item_skip_bool\n\\skip_set:Nn \\l__listsEX_custom_after_item_skip {#1} ,\nresume .bool_set:N = \\l__listsEX_resume_bool\n}\n\n% --------------------------------------------------------------------------\n% the generic environment:\n\\NewEnviron {__listsEX_env:} [3]\n{\n\\if@inlabel\n\\noindent\\par\\nobreak\\vskip-\\parskip\\vskip-\\baselineskip\\hrule\\@height\\z@\n\\fi\n\\dim_compare:nNnF { \\l__listsEX_before_list_skip } = { 0pt }\n{ \\vspace {\\l__listsEX_before_list_skip} }\n\\list {}\n{\n\\keys_set:nn {listsEX/list} {#2}\n\\dim_set:Nn \\leftmargin {0pt}\n\\dim_set:Nn \\rightmargin {0pt}\n}\n\\item \\scan_stop:\n\\int_incr:N \\l__listsEX_depth_int\n\\__listsEX:VnnV \\l__listsEX_instance_tl {#3} {#1} \\BODY\n\\endlist\n\\dim_compare:nNnF { \\l__listsEX_after_list_skip } = { 0pt }\n{ \\vspace {\\l__listsEX_after_list_skip} }\n}\n\n% --------------------------------------------------------------------------\n% command to start a new row:\n\\cs_new_protected:Npn \\listsEX_new_row:\n{\n\\int_gset:Nn \\g__listsEX_total_items_int\n{\n\\g__listsEX_total_items_int +\n\\l__listsEX_columns_int -\n\\g__listsEX_current_col_num_int\n}\n\\__listsEX_gset_rows_num:NN\n\\g__listsEX_total_items_int\n\\l__listsEX_columns_int\n\\int_gset_eq:NN \\g__listsEX_current_col_num_int \\l__listsEX_columns_int\n}\n\n\\NewDocumentCommand \\startnewitemlineEX {}\n{ \\listsEX_new_row: }\n\n% --------------------------------------------------------------------------\n% the user environment:\n\\NewDocumentCommand \\NewListsEX { O{}mO{\\listEX}D(){1} }\n{\n\\NewDocumentEnvironment {#2} { O{}D(){#4} }\n{ \\__listsEX_env: {#3} { #1,##1 } {##2} }\n{ \\end__listsEX_env: }\n}\n\n\\NewDocumentCommand \\RenewListsEX { O{}mO{\\listEX}D(){1} }\n{\n\\RenewDocumentEnvironment {#2} { O{}D(){#4} }\n{ \\__listsEX_env: {#3} { #1,##1 } {##2} }\n{ \\end__listsEX_env: }\n}\n\n% --------------------------------------------------------------------------\n% default list:\n\\NewListsEX {listsEX}\n\n\\file_if_exist:nT {listsEX.cfg} { \\file_input:n {listsEX.cfg} }\n\n% --------------------------------------------------------------------------\n% setup:\n\\cs_new_protected:Npn \\listsEX_setup:n #1\n{ \\keys_set:nn {listsEX/list} {#1} }\n\n\\NewDocumentCommand \\setlistsEX { m }\n{ \\listsEX_setup:n {#1} }\n\\newcommand{\\StartNumber}[1]{\n\\int_gset:Nn \\g__listsEX_int {#1}\n}\n%tasks\n\\NewListsEX{taskEX}[\\item]\n\\NewEnviron{listEX}[1][]{%\n\\hfill\n\\ifstrempty{#1}{%\n\\begin{enumerate}\n\\BODY\n\\end{enumerate}\n}{%\n\\def\\tempbegin{\\begin{taskEX}(#1)}%\n\\expandafter\\tempbegin\\BODY\n\\end{taskEX}\n}\n}\n\\NewEnviron{enumEX}[2][]{%\n\\hfill\n\\ifthenelse{\\equal{#2}{1}}\n{\n\\ifstrempty{#1}\n{\n\\begin{enumerate}\n\\BODY\n\\end{enumerate}\n}\n{\n\\begin{enumerate}[#1]\n\\BODY\n\\end{enumerate}}\n}\n{\n\\ifstrempty{#1}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a])](#2)}%\n}{%\n\\ifthenelse{\\equal{#1}{a.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(a)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[a]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{a)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[a])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{A.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[A].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(A)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[A]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{A)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[A])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{1.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[1].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(1)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[1]),label-width=1.3em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{1)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[1])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{i.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[r].](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(i)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[r]),label-width=1.4em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{i)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[r])](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{I.}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[R].,label-width=1.4em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{(I)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=(tsk[R]),label-width=1.6em](#2)}%\n}{\n\\ifthenelse{\\equal{#1}{I)}}{%\n\\def\\tempbegin{\\begin{taskEX}[counter-format=tsk[R]),label-width=1.4em](#2)}%\n}{\n\\def\\tempbegin{\\begin{taskEX}[label=#1](#2)}%\n}}}}}}}}}}}}}}}\n}\n\\expandafter\\tempbegin\\BODY\n\\end{taskEX}\n}\n}\n\\def\\loigiaiEX{\\colorbox{yellow!30!white}{Lời\\, giải.}}\n%End of file ‘ex_test.sty'.\n\n\n\n\n\\newif\\ifshowanswer\n\\showanswerfalse\n\\let \\hideanswer\\showanswerfalse\n\\let \\showanswer\\showanswertrue\n\\renewcommand{\\TrueEX}{\\ifshowanswer\\stepcounter{dapan}{{\\color{red}\\cbox{\\textbf{\\small\\Alph{dapan}}}} \\ignorespaces}\\else\\stepcounter{dapan}{{\\color{blue}\\cbox{\\textbf{\\small\\Alph{dapan}}}} \\ignorespaces}\\fi}\n\\newif \\ifhiendapan\\hiendapanfalse\n\\renewcommand{\\colorEX}{\\ifhiendapan\\color{red}\\else\\color{black}\\fi}"
                with codecs.open('Tool_ID/\\ex_test.sty', 'w', 'utf8') as (g):
                    g.write(ex_test)
                Print = ''
                t = time.time() - start_time
                hour, minute, second = Time_convert(t)
                reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(k) + ' câu thỏa mãn ID và từ khóa đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print + '\nBạn có muốn mở file không?', QMessageBox.Yes, QMessageBox.No)
                if reply == QMessageBox.Yes:
                    path='Tool_ID\\Key-[' + ID + ']-main.tex'
                    if openfile(path)=='Error':
                        QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
                    path='Tool_ID\\Key-[' + ID + '].tex'
                    if openfile(path)=='Error':
                        QMessageBox.critical(self, 'Lỗi','Lỗi mở file '+path)
                else:
                    Print = ''
                    t = time.time() - start_time
                    hour, minute, second = Time_convert(t)
                    reply = QMessageBox.question(self, 'Thông báo', 'Đã tìm thấy ' + str(k) + ' câu thỏa mãn ID và từ khóa đã cho.\nThời gian xử lí: ' + str(int(hour)) + ':' + str(int(minute)) + ':' + str(round(second, 2)) + '\n' + Print, QMessageBox.Yes)
        except Exception as er:
            TB_Error_TQ(self, str(er))